### 72. 게시글 첨부파일 단일 삭제 (교체 없이)

---

#### 1) **목표**

* 첨부파일 전체 교체가 아닌 특정 파일만 단일 삭제
* DB와 실제 파일 모두 삭제

---

#### 2) **Mapper 추가**

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardFileMapper.java`

```java
int deleteFileById(Long fileId);
BoardFileDto findFileById(Long fileId);
```

**경로**: `src/main/resources/mapper/BoardFileMapper.xml`

```xml
<select id="findFileById" parameterType="long" resultType="com.example.springbootstart.dto.BoardFileDto">
    SELECT * FROM board_file WHERE id = #{fileId}
</select>

<delete id="deleteFileById" parameterType="long">
    DELETE FROM board_file WHERE id = #{fileId}
</delete>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardFileService.java`

```java
import java.nio.file.*;

@Transactional
public boolean deleteFile(Long fileId) {
    // 1) 파일 정보 조회
    BoardFileDto file = boardFileMapper.findFileById(fileId);
    if (file == null) return false;

    // 2) DB 삭제
    int result = boardFileMapper.deleteFileById(fileId);

    // 3) 실제 파일 삭제
    if (result == 1) {
        Path path = Paths.get("uploads/" + file.getFilePath());
        try {
            Files.deleteIfExists(path);
        } catch (Exception e) {
            // 로그만 출력하고 진행
            e.printStackTrace();
        }
        return true;
    }
    return false;
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardFileController.java`

```java
@DeleteMapping("/{fileId}")
public ResponseEntity<?> deleteSingleFile(@PathVariable Long fileId) {
    boolean result = boardFileService.deleteFile(fileId);
    return result
            ? ResponseEntity.ok(Map.of("message", "첨부파일 삭제 성공"))
            : ResponseEntity.status(404).body(Map.of("message", "파일을 찾을 수 없습니다."));
}
```

---

#### 5) **테스트**

**DELETE 요청**

```
DELETE /board-files/10
```

**응답**

```json
{
  "message": "첨부파일 삭제 성공"
}
```

**DB 확인**

```sql
SELECT * FROM board_file WHERE id = 10;
```

→ 데이터가 삭제되어야 함

**서버 확인**

* `uploads/files/` 해당 파일 실제 삭제 확인

---

### 결과

* 특정 첨부파일만 선택적으로 삭제 가능
* 전체 교체 기능과 별도로 운영 가능

---

**다음 단계는 `73. 게시글 목록 조회 시 첨부파일 개수 표시` 입니다. 진행할까요?**
