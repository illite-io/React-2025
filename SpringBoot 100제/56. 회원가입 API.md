### 56. 댓글 개수 기준 인기 게시글 조회 (TOP N)

---

#### 1) **목표**

* 댓글이 많은 순으로 게시글 정렬
* 상위 N개의 게시글 반환 (`TOP N`)

---

#### 2) **Mapper 인터페이스**

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardMapper.java`

```java
package com.example.springbootstart.mapper;

import com.example.springbootstart.dto.BoardWithCommentCountDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;

@Mapper
public interface BoardMapper {
    List<BoardWithCommentCountDto> findTopBoardsByCommentCount(@Param("limit") int limit);
}
```

---

#### 3) **Mapper XML**

**경로**: `src/main/resources/mapper/BoardMapper.xml`

```xml
<select id="findTopBoardsByCommentCount" parameterType="int" 
        resultType="com.example.springbootstart.dto.BoardWithCommentCountDto">
    SELECT 
        b.id,
        b.user_id AS userId,
        b.title,
        b.content,
        b.created_at AS createdAt,
        b.updated_at AS updatedAt,
        (SELECT COUNT(*) FROM comment c WHERE c.board_id = b.id) AS commentCount
    FROM board b
    ORDER BY commentCount DESC
    LIMIT #{limit}
</select>
```

---

#### 4) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardService.java`

```java
import com.example.springbootstart.dto.BoardWithCommentCountDto;

public List<BoardWithCommentCountDto> getTopBoardsByCommentCount(int limit) {
    return boardMapper.findTopBoardsByCommentCount(limit);
}
```

---

#### 5) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardController.java`

```java
@GetMapping("/top")
public ResponseEntity<?> getTopBoards(@RequestParam(defaultValue = "5") int limit) {
    var boards = boardService.getTopBoardsByCommentCount(limit);
    return ResponseEntity.ok(boards);
}
```

---

#### 6) **테스트 요청**

**GET 요청**

```
http://localhost:8080/boards/top?limit=3
```

**응답(JSON 예시)**

```json
[
  {
    "id": 1,
    "userId": 1,
    "title": "첫 번째 게시글",
    "content": "안녕하세요, 첫 번째 게시글입니다.",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00",
    "commentCount": 5
  },
  {
    "id": 3,
    "userId": 2,
    "title": "세 번째 게시글",
    "content": "내용3",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00",
    "commentCount": 3
  },
  {
    "id": 2,
    "userId": 2,
    "title": "두 번째 게시글",
    "content": "내용2",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00",
    "commentCount": 1
  }
]
```

---

#### 7) **결과**

* 댓글 수 많은 순으로 게시글이 정렬되어 반환
* `limit` 값으로 상위 N개 제어 가능

---

**다음 단계는 `57. 사용자 프로필 + 작성 게시글 목록 반환` 입니다. 진행할까요?**
