좋습니다!
다음 단계는 **✅ 77. 다중 첨부파일 다운로드 (ZIP)** 입니다. 바로 이어서 설명드릴게요.

---

### 77. 다중 첨부파일 다운로드 (ZIP 압축)

---

#### 1) **목표**

* 게시글의 첨부파일 여러 개를 한 번에 ZIP으로 묶어 다운로드
* 예: `/board-files/download-zip/1` 요청 시 `board_1_files.zip` 다운로드

---

#### 2) **의존성 (기본 Java 기능 사용)**

* `java.util.zip.ZipOutputStream` 활용 → 별도 의존성 설치 불필요

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardFileService.java`

```java
import org.springframework.core.io.ByteArrayResource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;

import java.io.*;
import java.nio.file.*;
import java.util.List;
import java.util.zip.*;

public ResponseEntity<ByteArrayResource> downloadFilesAsZip(Long boardId) throws IOException {
    List<BoardFileDto> files = boardFileMapper.findFilesByBoardId(boardId);
    if (files.isEmpty()) {
        return ResponseEntity.notFound().build();
    }

    ByteArrayOutputStream byteOut = new ByteArrayOutputStream();
    try (ZipOutputStream zipOut = new ZipOutputStream(byteOut)) {
        for (BoardFileDto file : files) {
            Path path = Paths.get("uploads/" + file.getFilePath());
            if (!Files.exists(path)) continue;

            zipOut.putNextEntry(new ZipEntry(file.getFileName()));
            Files.copy(path, zipOut);
            zipOut.closeEntry();
        }
    }

    ByteArrayResource resource = new ByteArrayResource(byteOut.toByteArray());

    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"board_" + boardId + "_files.zip\"")
            .contentType(MediaType.APPLICATION_OCTET_STREAM)
            .contentLength(resource.contentLength())
            .body(resource);
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardFileController.java`

```java
import org.springframework.core.io.ByteArrayResource;
import org.springframework.http.ResponseEntity;

@GetMapping("/download-zip/{boardId}")
public ResponseEntity<ByteArrayResource> downloadZip(@PathVariable Long boardId) throws IOException {
    return boardFileService.downloadFilesAsZip(boardId);
}
```

---

#### 5) **테스트**

**GET 요청**

```
GET /board-files/download-zip/1
```

**응답**

* `board_1_files.zip` 파일 다운로드
* 압축 파일 안에 실제 첨부한 파일들이 포함되어야 함

---

#### 6) **오류 처리 보완**

* 없는 파일은 건너뛰고 압축
* 파일 하나도 없으면 404 응답

---

### ✅ 결과

* 게시글의 모든 첨부파일을 한 번에 다운로드 가능
* ZIP 파일로 압축하여 브라우저 다운로드 지원

---

**다음 단계는 `78. 게시글 수정 시 기존 첨부파일 유지 선택 기능` 입니다. 진행할까요?**
