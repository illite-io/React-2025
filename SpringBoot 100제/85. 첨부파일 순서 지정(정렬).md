### 85. 게시글 첨부파일 순서 지정 (정렬)

---

#### 1) **목표**

* 게시글 첨부파일에 **정렬 순서(order)** 부여
* 파일 목록을 사용자가 정렬한 순서대로 반환
* UI에서 Drag & Drop 정렬 후 순서 저장 가능하게 처리

---

#### 2) **DB 테이블 변경**

**SQL**

```sql
ALTER TABLE board_file ADD COLUMN sort_order INT DEFAULT 0 AFTER content_type;
```

---

#### 3) **DTO 수정**

**경로**: `src/main/java/com/example/springbootstart/dto/BoardFileDto.java`

```java
@Getter
@Setter
public class BoardFileDto {
    private Long id;
    private Long boardId;
    private String fileName;
    private String filePath;
    private String thumbnailPath;
    private Long fileSize;
    private String contentType;
    private Integer sortOrder;   // 추가
    private String createdAt;
}
```

---

#### 4) **Mapper 수정**

**경로**: `src/main/resources/mapper/BoardFileMapper.xml`

```xml
<select id="findFilesByBoardId" parameterType="long" resultType="com.example.springbootstart.dto.BoardFileDto">
    SELECT * FROM board_file 
    WHERE board_id = #{boardId} 
    ORDER BY sort_order ASC, id ASC
</select>

<update id="updateFileSortOrder">
    UPDATE board_file 
    SET sort_order = #{sortOrder} 
    WHERE id = #{id}
</update>
```

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardFileMapper.java`

```java
int updateFileSortOrder(@Param("id") Long id, @Param("sortOrder") int sortOrder);
```

---

#### 5) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardFileService.java`

```java
@Transactional
public void updateFileOrders(List<BoardFileDto> files) {
    for (BoardFileDto file : files) {
        boardFileMapper.updateFileSortOrder(file.getId(), file.getSortOrder());
    }
}
```

---

#### 6) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardFileController.java`

```java
import java.util.List;

@PutMapping("/sort-order")
public ResponseEntity<?> updateSortOrder(@RequestBody List<BoardFileDto> files) {
    boardFileService.updateFileOrders(files);
    return ResponseEntity.ok(Map.of("message", "첨부파일 순서가 저장되었습니다."));
}
```

---

#### 7) **프론트엔드 요청 예시 (정렬 완료 후)**

**PUT 요청**

```
PUT /board-files/sort-order
Content-Type: application/json

[
  { "id": 10, "sortOrder": 1 },
  { "id": 11, "sortOrder": 2 },
  { "id": 12, "sortOrder": 3 }
]
```

**응답**

```json
{ "message": "첨부파일 순서가 저장되었습니다." }
```

---

#### 8) **조회 시 정렬 적용**

* 기존 `findFilesByBoardId` SQL에서 `ORDER BY sort_order ASC` 추가됨
* 프론트엔드에 정렬 순서대로 파일 반환

---

### 결과

* 첨부파일 순서를 사용자가 직접 지정 가능
* UI에서 Drag & Drop 정렬 → 순서 저장 → 조회 시 적용

---

**다음 단계는 `86. 첨부파일 버전 관리(히스토리)` 입니다. 진행할까요?**
