### 93. 파일 접근 로그 페이징 처리

---

#### 1) **목표**

* 파일 접근 로그 조회 시 **페이징 처리** 추가
* 관리자 페이지에서 로그 데이터가 많아도 성능 문제 없이 처리 가능

---

#### 2) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import org.apache.ibatis.annotations.Param;

List<FileAccessLogDto> findAccessLogsPaged(@Param("fileId") Long fileId,
                                           @Param("userId") Long userId,
                                           @Param("actionType") String actionType,
                                           @Param("startDate") String startDate,
                                           @Param("endDate") String endDate,
                                           @Param("offset") int offset,
                                           @Param("limit") int limit);

int countAccessLogs(@Param("fileId") Long fileId,
                    @Param("userId") Long userId,
                    @Param("actionType") String actionType,
                    @Param("startDate") String startDate,
                    @Param("endDate") String endDate);
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findAccessLogsPaged" resultType="com.example.springbootstart.dto.FileAccessLogDto">
    SELECT * FROM file_access_log
    WHERE (#{fileId} IS NULL OR file_id = #{fileId})
      AND (#{userId} IS NULL OR user_id = #{userId})
      AND (#{actionType} IS NULL OR action_type = #{actionType})
      AND (#{startDate} IS NULL OR access_time >= #{startDate})
      AND (#{endDate} IS NULL OR access_time <= #{endDate})
    ORDER BY access_time DESC
    LIMIT #{limit} OFFSET #{offset}
</select>

<select id="countAccessLogs" resultType="int">
    SELECT COUNT(*) FROM file_access_log
    WHERE (#{fileId} IS NULL OR file_id = #{fileId})
      AND (#{userId} IS NULL OR user_id = #{userId})
      AND (#{actionType} IS NULL OR action_type = #{actionType})
      AND (#{startDate} IS NULL OR access_time >= #{startDate})
      AND (#{endDate} IS NULL OR access_time <= #{endDate})
</select>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
import java.util.HashMap;
import java.util.Map;

public Map<String, Object> getAccessLogsPaged(Long fileId, Long userId, String actionType,
                                              String startDate, String endDate,
                                              int page, int size) {
    int offset = (page - 1) * size;
    List<FileAccessLogDto> logs = logMapper.findAccessLogsPaged(fileId, userId, actionType, startDate, endDate, offset, size);
    int total = logMapper.countAccessLogs(fileId, userId, actionType, startDate, endDate);

    Map<String, Object> result = new HashMap<>();
    result.put("logs", logs);
    result.put("total", total);
    result.put("page", page);
    result.put("size", size);
    return result;
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/paged")
public ResponseEntity<Map<String, Object>> getLogsPaged(
        @RequestParam(required = false) Long fileId,
        @RequestParam(required = false) Long userId,
        @RequestParam(required = false) String actionType,
        @RequestParam(required = false) String startDate,
        @RequestParam(required = false) String endDate,
        @RequestParam(defaultValue = "1") int page,
        @RequestParam(defaultValue = "10") int size) {
    return ResponseEntity.ok(logService.getAccessLogsPaged(fileId, userId, actionType, startDate, endDate, page, size));
}
```

---

#### 5) **테스트**

**GET 요청**

```
GET /file-access-logs/paged?page=2&size=5
```

**응답 예시**

```json
{
  "logs": [
    { "fileId": 10, "userId": 5, "actionType": "DOWNLOAD", "accessTime": "2025-08-03T12:30:00" },
    { "fileId": 10, "userId": 5, "actionType": "RESTORE", "accessTime": "2025-08-03T12:31:00" }
  ],
  "total": 50,
  "page": 2,
  "size": 5
}
```

---

### 결과

* 파일 접근 로그 조회 시 **페이징 처리** 가능
* 대량 로그 데이터 처리 및 UI 페이지네이션 용이

---

**다음 단계는 `94. 파일 접근 로그 엑셀 다운로드` 입니다. 진행할까요?**
