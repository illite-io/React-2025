### 97. 파일 접근 로그 사용자별 순위 (Top 10)

---

#### 1) **목표**

* 최근 파일 접근 로그를 **사용자별 집계**하여 순위화
* **Top 10** 사용자 (다운로드 + 복원 전체 포함) 제공
* 관리자 페이지에서 많이 사용하는 사용자 식별에 활용

---

#### 2) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import java.util.List;
import java.util.Map;

List<Map<String, Object>> findTop10Users();
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findTop10Users" resultType="map">
    SELECT user_id, COUNT(*) AS accessCount
    FROM file_access_log
    WHERE user_id IS NOT NULL
    GROUP BY user_id
    ORDER BY accessCount DESC
    LIMIT 10;
</select>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
public List<Map<String, Object>> getTop10Users() {
    return logMapper.findTop10Users();
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/stats/top-users")
public ResponseEntity<List<Map<String, Object>>> getTop10Users() {
    return ResponseEntity.ok(logService.getTop10Users());
}
```

---

#### 5) **프론트엔드 예시 (React + Chart.js Bar 차트)**

```javascript
import { useEffect, useState } from "react";
import { Bar } from "react-chartjs-2";

function TopUsersChart() {
  const [chartData, setChartData] = useState({});

  useEffect(() => {
    fetch("/file-access-logs/stats/top-users")
      .then(res => res.json())
      .then(data => {
        setChartData({
          labels: data.map(u => "User " + u.user_id),
          datasets: [
            {
              label: "접근 횟수",
              data: data.map(u => u.accessCount),
              backgroundColor: "rgba(75,192,192,0.6)"
            }
          ]
        });
      });
  }, []);

  return <Bar data={chartData} />;
}
export default TopUsersChart;
```

---

#### 6) **테스트**

**GET 요청**

```
GET /file-access-logs/stats/top-users
```

**응답 예시**

```json
[
  { "user_id": 5, "accessCount": 25 },
  { "user_id": 2, "accessCount": 19 },
  { "user_id": 10, "accessCount": 12 }
]
```

→ React 차트에서 막대그래프로 표시됨

---

### 결과

* 파일 접근 로그를 사용자별로 집계하여 **Top 10** 순위 제공
* 관리자/보안 담당자가 주요 사용자 활동 분석 가능

---

**다음 단계는 `98. 특정 파일별 접근 빈도 분석` 입니다. 진행할까요?**
