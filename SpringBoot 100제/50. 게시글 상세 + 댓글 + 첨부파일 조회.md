### 50. 회원-게시글-댓글 관계 조회 (JOIN)

---

#### 1) **목표**

* 회원, 게시글, 댓글 데이터를 **JOIN**하여 한 번에 조회
* 특정 게시글을 조회 시 → 게시글 + 작성자 정보 + 댓글 목록 + 댓글 작성자 정보

---

#### 2) **조회 결과 예시**

**URL 예시:**

```
GET /boards/detail/1
```

**응답 예시(JSON)**:

```json
{
  "board": {
    "id": 1,
    "title": "첫 번째 게시글",
    "content": "안녕하세요, 첫 번째 게시글입니다.",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00",
    "writer": {
      "id": 1,
      "name": "홍길동",
      "email": "hong@test.com"
    }
  },
  "comments": [
    {
      "id": 1,
      "content": "첫 댓글입니다. 반갑습니다.",
      "createdAt": "2025-08-03T12:00:00",
      "writer": {
        "id": 2,
        "name": "이순신",
        "email": "lee@test.com"
      }
    }
  ]
}
```

---

#### 3) **DTO 추가**

**경로**: `src/main/java/com/example/springbootstart/dto/BoardDetailDto.java`

```java
package com.example.springbootstart.dto;

import lombok.Getter;
import lombok.Setter;
import java.util.List;

@Getter
@Setter
public class BoardDetailDto {
    private Long id;
    private String title;
    private String content;
    private String createdAt;
    private String updatedAt;

    // 작성자 정보
    private Long writerId;
    private String writerName;
    private String writerEmail;

    // 댓글 목록
    private List<CommentWithUserDto> comments;
}
```

**경로**: `src/main/java/com/example/springbootstart/dto/CommentWithUserDto.java`

```java
package com.example.springbootstart.dto;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class CommentWithUserDto {
    private Long id;
    private String content;
    private String createdAt;

    private Long writerId;
    private String writerName;
    private String writerEmail;
}
```

---

#### 4) **Mapper 인터페이스**

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardMapper.java`

```java
package com.example.springbootstart.mapper;

import com.example.springbootstart.dto.BoardDetailDto;
import com.example.springbootstart.dto.CommentWithUserDto;
import org.apache.ibatis.annotations.Mapper;

import java.util.List;

@Mapper
public interface BoardMapper {
    BoardDetailDto findBoardDetail(Long id);
    List<CommentWithUserDto> findCommentsWithUser(Long boardId);
}
```

---

#### 5) **Mapper XML**

**경로**: `src/main/resources/mapper/BoardMapper.xml`

```xml
<select id="findBoardDetail" parameterType="long" resultType="com.example.springbootstart.dto.BoardDetailDto">
    SELECT b.id,
           b.title,
           b.content,
           b.created_at AS createdAt,
           b.updated_at AS updatedAt,
           u.id AS writerId,
           u.name AS writerName,
           u.email AS writerEmail
    FROM board b
    JOIN user u ON b.user_id = u.id
    WHERE b.id = #{id}
</select>

<select id="findCommentsWithUser" parameterType="long" resultType="com.example.springbootstart.dto.CommentWithUserDto">
    SELECT c.id,
           c.content,
           c.created_at AS createdAt,
           u.id AS writerId,
           u.name AS writerName,
           u.email AS writerEmail
    FROM comment c
    JOIN user u ON c.user_id = u.id
    WHERE c.board_id = #{boardId}
    ORDER BY c.id DESC
</select>
```

---

#### 6) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardService.java`

```java
package com.example.springbootstart.service;

import com.example.springbootstart.dto.BoardDetailDto;
import com.example.springbootstart.dto.CommentWithUserDto;
import com.example.springbootstart.mapper.BoardMapper;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class BoardService {
    private final BoardMapper boardMapper;

    public BoardService(BoardMapper boardMapper) {
        this.boardMapper = boardMapper;
    }

    public BoardDetailDto getBoardDetail(Long id) {
        BoardDetailDto board = boardMapper.findBoardDetail(id);
        if (board != null) {
            List<CommentWithUserDto> comments = boardMapper.findCommentsWithUser(id);
            board.setComments(comments);
        }
        return board;
    }
}
```

---

#### 7) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardController.java`

```java
@GetMapping("/detail/{id}")
public ResponseEntity<?> getBoardDetail(@PathVariable Long id) {
    BoardDetailDto boardDetail = boardService.getBoardDetail(id);
    return boardDetail != null ? ResponseEntity.ok(boardDetail)
                               : ResponseEntity.notFound().build();
}
```

---

#### 8) **테스트 요청**

```
GET http://localhost:8080/boards/detail/1
```

**응답(JSON)** → 회원 + 게시글 + 댓글 + 댓글 작성자 정보 함께 조회

---

**다음 단계는 `51. MyBatis resultMap 고급 매핑 (중첩 매핑)` 입니다. 진행할까요?**
