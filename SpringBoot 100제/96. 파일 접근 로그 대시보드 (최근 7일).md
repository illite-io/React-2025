### 96. 파일 접근 로그 대시보드 (최근 7일 그래프)

---

#### 1) **목표**

* 최근 7일간의 파일 접근 로그를 날짜별로 집계
* **액션타입별**(DOWNLOAD, RESTORE) 건수 그래프로 표현할 수 있는 API 제공
* 프론트엔드(React 등)에서 차트 라이브러리로 시각화

---

#### 2) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import java.util.List;
import java.util.Map;

List<Map<String, Object>> findAccessLogStatsLast7Days();
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findAccessLogStatsLast7Days" resultType="map">
    SELECT DATE(access_time) AS date,
           action_type,
           COUNT(*) AS count
    FROM file_access_log
    WHERE access_time >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
    GROUP BY DATE(access_time), action_type
    ORDER BY date ASC;
</select>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
public List<Map<String, Object>> getLast7DaysStats() {
    return logMapper.findAccessLogStatsLast7Days();
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/stats/last7days")
public ResponseEntity<List<Map<String, Object>>> getLast7DaysStats() {
    return ResponseEntity.ok(logService.getLast7DaysStats());
}
```

---

#### 5) **프론트엔드 예시 (React + Chart.js)**

```javascript
import { useEffect, useState } from "react";
import { Line } from "react-chartjs-2";

function LogChart() {
  const [chartData, setChartData] = useState({});

  useEffect(() => {
    fetch("/file-access-logs/stats/last7days")
      .then(res => res.json())
      .then(data => {
        const dates = [...new Set(data.map(d => d.date))];
        const downloadData = dates.map(date => {
          const item = data.find(d => d.date === date && d.action_type === "DOWNLOAD");
          return item ? item.count : 0;
        });
        const restoreData = dates.map(date => {
          const item = data.find(d => d.date === date && d.action_type === "RESTORE");
          return item ? item.count : 0;
        });

        setChartData({
          labels: dates,
          datasets: [
            { label: "DOWNLOAD", data: downloadData, borderColor: "blue", fill: false },
            { label: "RESTORE", data: restoreData, borderColor: "green", fill: false }
          ]
        });
      });
  }, []);

  return <Line data={chartData} />;
}
export default LogChart;
```

---

#### 6) **테스트**

**GET 요청**

```
GET /file-access-logs/stats/last7days
```

**응답 예시**

```json
[
  { "date": "2025-07-28", "action_type": "DOWNLOAD", "count": 5 },
  { "date": "2025-07-28", "action_type": "RESTORE", "count": 1 },
  { "date": "2025-07-29", "action_type": "DOWNLOAD", "count": 3 }
]
```

→ React 차트에서 날짜별 그래프 정상 출력

---

### 결과

* 최근 7일간 파일 접근 로그 통계를 제공하는 API 구현
* 프론트엔드에서 손쉽게 그래프 시각화 가능

---

**다음 단계는 `97. 파일 접근 로그 사용자별 순위(Top 10)` 입니다. 진행할까요?**
