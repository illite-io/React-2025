### 92. 파일 접근 로그 조회 (필터링)

---

#### 1) **목표**

* 파일 접근 로그를 **필터링**(파일 ID, 사용자 ID, 액션 타입, 날짜 범위)해서 조회
* 관리자 또는 감사(Audit) 화면에서 활용

---

#### 2) **DTO**

기존 `FileAccessLogDto` 그대로 사용

---

#### 3) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import java.util.List;
import java.util.Map;

List<FileAccessLogDto> findAccessLogs(Map<String, Object> params);
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findAccessLogs" parameterType="map" resultType="com.example.springbootstart.dto.FileAccessLogDto">
    SELECT * FROM file_access_log
    WHERE (#{fileId} IS NULL OR file_id = #{fileId})
      AND (#{userId} IS NULL OR user_id = #{userId})
      AND (#{actionType} IS NULL OR action_type = #{actionType})
      AND (#{startDate} IS NULL OR access_time >= #{startDate})
      AND (#{endDate} IS NULL OR access_time <= #{endDate})
    ORDER BY access_time DESC
</select>
```

---

#### 4) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
import java.util.List;
import java.util.Map;

public List<FileAccessLogDto> getAccessLogs(Long fileId, Long userId, String actionType,
                                            String startDate, String endDate) {
    Map<String, Object> params = Map.of(
        "fileId", fileId,
        "userId", userId,
        "actionType", actionType,
        "startDate", startDate,
        "endDate", endDate
    );
    return logMapper.findAccessLogs(params);
}
```

---

#### 5) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequestMapping("/file-access-logs")
public class FileAccessLogController {
    private final FileAccessLogService logService;

    public FileAccessLogController(FileAccessLogService logService) {
        this.logService = logService;
    }

    @GetMapping
    public ResponseEntity<List<FileAccessLogDto>> getLogs(
            @RequestParam(required = false) Long fileId,
            @RequestParam(required = false) Long userId,
            @RequestParam(required = false) String actionType,
            @RequestParam(required = false) String startDate,
            @RequestParam(required = false) String endDate) {
        return ResponseEntity.ok(logService.getAccessLogs(fileId, userId, actionType, startDate, endDate));
    }
}
```

---

#### 6) **테스트**

**GET 요청 (전체 로그)**

```
GET /file-access-logs
```

**응답 예시**

```json
[
  { "fileId": 10, "userId": 5, "actionType": "DOWNLOAD", "accessTime": "2025-08-03T12:30:00" },
  { "fileId": 10, "userId": 5, "actionType": "RESTORE", "accessTime": "2025-08-03T12:31:00" }
]
```

**GET 요청 (특정 파일, 특정 액션)**

```
GET /file-access-logs?fileId=10&actionType=DOWNLOAD
```

**응답**

```json
[
  { "fileId": 10, "userId": 5, "actionType": "DOWNLOAD", "accessTime": "2025-08-03T12:30:00" }
]
```

---

### 결과

* 파일 접근 로그를 다양한 조건으로 필터링 가능
* 보안 감사, 사용자 활동 모니터링에 활용

---

**다음 단계는 `93. 파일 접근 로그 페이징 처리` 입니다. 진행할까요?**
