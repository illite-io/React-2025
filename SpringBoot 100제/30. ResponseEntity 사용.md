### 30. MyBatis 연동 테스트

---

#### 1) **목표**

* 작성한 **UserMapper 인터페이스**와 **UserMapper.xml**이 정상 동작하는지 확인
* DB에서 실제 데이터 조회 및 조작 테스트

---

#### 2) **테스트 Controller 작성**

**경로**: `src/main/java/com/example/springbootstart/controller/UserTestController.java`

```java
package com.example.springbootstart.controller;

import com.example.springbootstart.dto.UserDto;
import com.example.springbootstart.mapper.UserMapper;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/user-test")
public class UserTestController {

    private final UserMapper userMapper;

    public UserTestController(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    // 전체 조회
    @GetMapping("/all")
    public List<UserDto> getAllUsers() {
        return userMapper.findAll();
    }

    // 단일 조회
    @GetMapping("/{id}")
    public UserDto getUser(@PathVariable Long id) {
        return userMapper.findById(id);
    }

    // 등록
    @PostMapping
    public String createUser(@RequestBody UserDto userDto) {
        int result = userMapper.insertUser(userDto);
        return result == 1 ? "등록 성공" : "등록 실패";
    }

    // 수정
    @PutMapping("/{id}")
    public String updateUser(@PathVariable Long id, @RequestBody UserDto userDto) {
        userDto.setId(id);
        int result = userMapper.updateUser(userDto);
        return result == 1 ? "수정 성공" : "수정 실패";
    }

    // 삭제
    @DeleteMapping("/{id}")
    public String deleteUser(@PathVariable Long id) {
        int result = userMapper.deleteUser(id);
        return result == 1 ? "삭제 성공" : "삭제 실패";
    }
}
```

---

#### 3) **실행 테스트**

1. 서버 실행
2. Postman 또는 브라우저에서 호출:

   * **전체 조회**: `GET http://localhost:8080/user-test/all`
   * **단일 조회**: `GET http://localhost:8080/user-test/1`
   * **등록**: `POST http://localhost:8080/user-test`

     ```json
     {
       "name": "유관순",
       "age": 25,
       "email": "yoo@test.com"
     }
     ```
   * **수정**: `PUT http://localhost:8080/user-test/1`

     ```json
     {
       "name": "홍길동(수정)",
       "age": 31,
       "email": "hong2@test.com"
     }
     ```
   * **삭제**: `DELETE http://localhost:8080/user-test/3`

---

#### 4) **결과 확인**

* DB 반영 여부 확인:

```sql
SELECT * FROM user;
```

* 등록 → 새로운 데이터 추가
* 수정 → 해당 사용자 데이터 변경
* 삭제 → 해당 사용자 데이터 삭제

---

**다음 단계는 `31. 회원 등록 API 작성` (회원 CRUD 시작) 입니다. 진행할까요?**
