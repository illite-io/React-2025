### 76. 첨부파일 다운로드 (개별)

---

#### 1) **목표**

* 첨부파일 ID로 개별 파일 다운로드
* 브라우저가 파일 저장하도록 `Content-Disposition` 헤더 처리

---

#### 2) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardFileService.java`

```java
import org.springframework.core.io.FileSystemResource;
import org.springframework.core.io.Resource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;

import java.nio.file.Path;
import java.nio.file.Paths;

public ResponseEntity<Resource> downloadFile(Long fileId) {
    BoardFileDto file = boardFileMapper.findFileById(fileId);
    if (file == null) {
        return ResponseEntity.notFound().build();
    }

    Path path = Paths.get("uploads/" + file.getFilePath());
    Resource resource = new FileSystemResource(path.toFile());

    if (!resource.exists()) {
        return ResponseEntity.notFound().build();
    }

    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + file.getFileName() + "\"")
            .contentType(MediaType.APPLICATION_OCTET_STREAM)
            .body(resource);
}
```

---

#### 3) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardFileController.java`

```java
import org.springframework.core.io.Resource;
import org.springframework.http.ResponseEntity;

@GetMapping("/download/{fileId}")
public ResponseEntity<Resource> downloadFile(@PathVariable Long fileId) {
    return boardFileService.downloadFile(fileId);
}
```

---

#### 4) **테스트**

**GET 요청**

```
GET /board-files/download/5
```

**응답**

* 브라우저 파일 다운로드 동작 (예: `문서.pdf`)

**DB 확인**

* `filePath` 확인 → 실제 파일과 동일해야 함

---

#### 5) **보안 고려**

* 현재 모든 사용자 다운로드 가능
* 필요 시 로그인/권한 체크 추가 가능 (JWT나 세션 기반)

---

### 결과

* 첨부파일 개별 다운로드 기능 완성
* 파일명 그대로 다운로드됨

---

**다음 단계는 `77. 다중 첨부파일 다운로드 (ZIP)` 입니다. 진행할까요?**
