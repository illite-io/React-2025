### 46. 댓글 등록 API

---

#### 1) **목표**

* 특정 게시글에 대한 댓글 등록 API 작성
* DB: `comment` 테이블 사용

---

#### 2) **DTO 작성**

**경로**: `src/main/java/com/example/springbootstart/dto/CommentDto.java`

```java
package com.example.springbootstart.dto;

import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Getter
@Setter
@ToString
public class CommentDto {
    private Long id;        // 댓글 ID
    private Long boardId;   // 게시글 ID
    private Long userId;    // 작성자 ID
    private String content; // 댓글 내용
    private String createdAt;
    private String updatedAt;
}
```

---

#### 3) **Mapper 인터페이스**

**경로**: `src/main/java/com/example/springbootstart/mapper/CommentMapper.java`

```java
package com.example.springbootstart.mapper;

import com.example.springbootstart.dto.CommentDto;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface CommentMapper {
    int insertComment(CommentDto commentDto);
}
```

---

#### 4) **Mapper XML**

**경로**: `src/main/resources/mapper/CommentMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.springbootstart.mapper.CommentMapper">

    <insert id="insertComment" parameterType="com.example.springbootstart.dto.CommentDto">
        INSERT INTO comment (board_id, user_id, content)
        VALUES (#{boardId}, #{userId}, #{content})
    </insert>

</mapper>
```

---

#### 5) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/CommentService.java`

```java
package com.example.springbootstart.service;

import com.example.springbootstart.dto.CommentDto;
import com.example.springbootstart.mapper.CommentMapper;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
public class CommentService {
    private final CommentMapper commentMapper;

    public CommentService(CommentMapper commentMapper) {
        this.commentMapper = commentMapper;
    }

    @Transactional
    public int createComment(CommentDto commentDto) {
        return commentMapper.insertComment(commentDto);
    }
}
```

---

#### 6) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/CommentController.java`

```java
package com.example.springbootstart.controller;

import com.example.springbootstart.dto.CommentDto;
import com.example.springbootstart.service.CommentService;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/comments")
public class CommentController {

    private final CommentService commentService;
    public CommentController(CommentService commentService) {
        this.commentService = commentService;
    }

    // 댓글 등록
    @PostMapping
    public ResponseEntity<?> createComment(@RequestBody CommentDto commentDto) {
        int result = commentService.createComment(commentDto);
        return result == 1 ? ResponseEntity.ok("댓글 등록 성공")
                           : ResponseEntity.badRequest().body("댓글 등록 실패");
    }
}
```

---

#### 7) **테스트 요청**

**POST 요청**

```
http://localhost:8080/comments
```

**Body(JSON)**:

```json
{
  "boardId": 1,
  "userId": 2,
  "content": "새로운 댓글입니다."
}
```

**응답**

```
댓글 등록 성공
```

---

#### 8) **DB 확인**

```sql
SELECT * FROM comment WHERE board_id = 1;
```

* 댓글이 추가되어 있어야 함

---

**다음 단계는 `47. 댓글 조회 API (게시글 기준)` 입니다. 진행할까요?**
