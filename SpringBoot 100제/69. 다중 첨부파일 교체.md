### 69. 업로드한 프로필 이미지 제공 (URL로 접근)

---

#### 1) **목표**

* 업로드한 프로필 이미지를 URL을 통해 접근 가능하게 제공
* 예: `http://localhost:8080/images/profile/1_profile.jpg`

---

#### 2) **정적 리소스 경로 설정**

Spring Boot는 기본적으로 `/static`, `/public`, `/resources` 폴더를 정적 리소스 경로로 사용
→ 업로드 이미지는 별도 경로(`uploads/profile`)에 저장되므로 `WebMvcConfigurer` 설정 필요

---

#### 3) **WebConfig 수정**

**경로**: `src/main/java/com/example/springbootstart/config/WebConfig.java`

```java
package com.example.springbootstart.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 업로드한 프로필 이미지를 /images/profile/** 경로로 접근 가능하게 설정
        registry.addResourceHandler("/images/profile/**")
                .addResourceLocations("file:uploads/profile/");
    }
}
```

* `"file:uploads/profile/"` → 실제 파일 경로

---

#### 4) **DB 저장된 경로 변경**

* 68단계에서 저장 경로를 `uploads/profile/파일명`으로 했는데, URL 접근 위해 `profile/파일명`만 저장하는 편이 좋음
* Controller 수정:

```java
String filename = userId + "_" + file.getOriginalFilename();
String relativePath = "profile/" + filename; // DB에 저장할 상대 경로
String fullPath = "uploads/" + relativePath; // 실제 파일 경로

Files.createDirectories(Paths.get("uploads/profile/"));
file.transferTo(Paths.get(fullPath).toFile());

userService.updateProfileImage(userId, relativePath);
```

---

#### 5) **Controller - 이미지 URL 반환**

```java
return ResponseEntity.ok(Map.of(
    "message", "프로필 이미지 업로드 성공",
    "url", "/images/" + relativePath
));
```

---

#### 6) **테스트**

**POST 업로드 후 결과**

```json
{
  "message": "프로필 이미지 업로드 성공",
  "url": "/images/profile/1_profile.jpg"
}
```

→ 브라우저에서 `http://localhost:8080/images/profile/1_profile.jpg` 접근 시 이미지 표시

---

#### 7) **보안 고려**

* 프로필 이미지는 공개 가능하므로 인증 불필요
* 만약 비공개 처리 필요 시 Controller에서 `ResponseEntity<Resource>` 형태로 인증 후 제공하도록 변경 가능

---

### 결과

* 업로드한 이미지 파일을 URL로 직접 접근 가능
* 프론트엔드에서 사용자 프로필 이미지 쉽게 표시 가능

---

**다음 단계는 `70. 게시글 첨부파일 업로드` 입니다. 진행할까요?**
