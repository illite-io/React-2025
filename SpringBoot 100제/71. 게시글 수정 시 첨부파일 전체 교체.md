### 71. 첨부파일 삭제

---

#### 1) **목표**

* 게시글에 첨부된 파일 삭제
* **DB 데이터**와 **실제 파일** 모두 제거

---

#### 2) **Mapper 수정**

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardFileMapper.java`

```java
int deleteFile(@Param("id") Long id);
BoardFileDto findFileById(@Param("id") Long id);
```

**경로**: `src/main/resources/mapper/BoardFileMapper.xml`

```xml
<select id="findFileById" parameterType="long" resultType="com.example.springbootstart.dto.BoardFileDto">
    SELECT id, board_id AS boardId, original_name AS originalName,
           stored_path AS storedPath, created_at AS createdAt
    FROM board_file
    WHERE id = #{id}
</select>

<delete id="deleteFile" parameterType="long">
    DELETE FROM board_file WHERE id = #{id}
</delete>
```

---

#### 3) **Service 작성**

**경로**: `src/main/java/com/example/springbootstart/service/BoardFileService.java`

```java
import java.nio.file.Files;
import java.nio.file.Paths;

@Transactional
public boolean deleteFile(Long id) {
    BoardFileDto fileDto = boardFileMapper.findFileById(id);
    if (fileDto == null) return false;

    // 실제 파일 삭제
    try {
        Files.deleteIfExists(Paths.get("uploads/" + fileDto.getStoredPath()));
    } catch (Exception e) {
        throw new RuntimeException("파일 삭제 실패: " + e.getMessage());
    }

    // DB 삭제
    return boardFileMapper.deleteFile(id) == 1;
}
```

---

#### 4) **Controller 작성**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardFileController.java`

```java
@DeleteMapping("/{fileId}")
public ResponseEntity<?> deleteFile(@PathVariable Long fileId) {
    boolean deleted = boardFileService.deleteFile(fileId);
    return deleted 
        ? ResponseEntity.ok("첨부파일 삭제 성공") 
        : ResponseEntity.badRequest().body("파일을 찾을 수 없습니다.");
}
```

---

#### 5) **테스트**

1. **파일 삭제 요청**

   ```
   DELETE http://localhost:8080/boards/files/1
   ```

   **응답**

   ```
   첨부파일 삭제 성공
   ```

2. **DB 확인**

   ```sql
   SELECT * FROM board_file WHERE id=1;
   ```

   → 결과 없음

3. **파일 경로 확인**

   ```
   uploads/board/1_test.png → 존재하지 않아야 함
   ```

---

### 결과

* 첨부파일 DB 데이터 + 실제 파일 삭제 기능 완성
* 게시판 첨부파일 관리 완료

---

**다음 단계는 `72. 게시글 + 첨부파일 함께 조회` 입니다. 진행할까요?**
