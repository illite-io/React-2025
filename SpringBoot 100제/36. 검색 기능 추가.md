### 36. 회원 데이터 유효성 검사

---

#### 1) **목표**

* 회원 등록 및 수정 시 \*\*유효하지 않은 데이터(빈 문자열, 음수 나이 등)\*\*가 DB에 들어가지 않도록 사전 검증
* Spring Boot의 **Validation(Bean Validation)** 기능 사용

---

#### 2) **의존성 추가 (pom.xml)**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

> **주의**: 이미 `spring-boot-starter-web`을 사용하면 `validation` 라이브러리가 함께 포함되는 경우가 많음.
> 에러 시 위 의존성을 추가하세요.

---

#### 3) **DTO 수정**

**파일 경로**: `src/main/java/com/example/springbootstart/dto/UserDto.java`

```java
package com.example.springbootstart.dto;

import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

import javax.validation.constraints.Email;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Getter
@Setter
@ToString
public class UserDto {
    private Long id;

    @NotBlank(message = "이름은 필수 입력 값입니다.")
    private String name;

    @Min(value = 1, message = "나이는 1 이상이어야 합니다.")
    private int age;

    @Email(message = "올바른 이메일 형식이 아닙니다.")
    private String email;

    private String createdAt;
    private String updatedAt;
}
```

---

#### 4) **Controller에서 유효성 적용**

**파일 경로**: `src/main/java/com/example/springbootstart/controller/UserController.java`

```java
package com.example.springbootstart.controller;

import com.example.springbootstart.dto.UserDto;
import com.example.springbootstart.service.UserService;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;

@RestController
@RequestMapping("/users")
@Validated
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping
    public String createUser(@Valid @RequestBody UserDto userDto) {
        int result = userService.createUser(userDto);
        return result == 1 ? "회원 등록 성공" : "회원 등록 실패";
    }

    @PutMapping("/{id}")
    public String updateUser(@PathVariable Long id, @Valid @RequestBody UserDto userDto) {
        userDto.setId(id);
        int result = userService.updateUser(userDto);
        return result == 1 ? "회원 수정 성공" : "회원 수정 실패";
    }

    @GetMapping
    public List<UserDto> getAllUsers() {
        return userService.getAllUsers();
    }

    @GetMapping("/{id}")
    public UserDto getUser(@PathVariable Long id) {
        return userService.getUser(id);
    }

    @DeleteMapping("/{id}")
    public String deleteUser(@PathVariable Long id) {
        int result = userService.deleteUser(id);
        return result == 1 ? "회원 삭제 성공" : "회원 삭제 실패";
    }
}
```

---

#### 5) **테스트 요청**

**POST 요청 (잘못된 데이터)**

```json
{
  "name": "",
  "age": 0,
  "email": "not-email"
}
```

**응답 (자동 400 에러)**

```json
{
  "timestamp": "2025-08-03T12:00:00",
  "status": 400,
  "errors": [
    "이름은 필수 입력 값입니다.",
    "나이는 1 이상이어야 합니다.",
    "올바른 이메일 형식이 아닙니다."
  ]
}
```

---

#### 6) **결과**

* 데이터 유효성 검사로 **잘못된 데이터 저장 방지**
* 향후 **GlobalExceptionHandler**로 응답 포맷을 통일 가능(추후 단계에서 진행)

---

**다음 단계는 `37. 예외 처리 (ExceptionHandler)` 입니다. 진행할까요?**
