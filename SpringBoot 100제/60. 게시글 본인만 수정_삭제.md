### 60. 로그인 사용자만 글 작성 가능 (세션 검사)

---

#### 1) **목표**

* **세션에 로그인 사용자 정보가 있는 경우에만 글 작성 허용**
* 비로그인 상태에서 글 작성 요청 시 **에러 응답 반환**

---

#### 2) **Controller 수정 (게시글 작성)**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardController.java`

```java
import javax.servlet.http.HttpSession;

@PostMapping
public ResponseEntity<?> createBoard(@RequestBody BoardDto boardDto, HttpSession session) {
    // 로그인 사용자 세션 체크
    var loginUser = session.getAttribute("loginUser");
    if (loginUser == null) {
        return ResponseEntity.status(401).body(Map.of("message", "로그인이 필요합니다."));
    }

    // 세션 사용자 정보에서 userId 가져오기
    UserDto user = (UserDto) loginUser;
    boardDto.setUserId(user.getId());

    int result = boardService.createBoard(boardDto);
    return result == 1
            ? ResponseEntity.ok(Map.of("message", "게시글 등록 성공"))
            : ResponseEntity.badRequest().body(Map.of("message", "게시글 등록 실패"));
}
```

---

#### 3) **테스트 요청**

1. **로그인 없이 게시글 작성**

   ```
   POST http://localhost:8080/boards
   Body(JSON):
   {
       "title": "세션 없이 작성한 글",
       "content": "로그인 안함"
   }
   ```

   **응답**

   ```json
   {
       "message": "로그인이 필요합니다."
   }
   ```

2. **로그인 후 게시글 작성**

   * `POST /users/login` 호출하여 세션 유지
   * 이후 `POST /boards` 요청
     **응답**

   ```json
   {
       "message": "게시글 등록 성공"
   }
   ```

---

#### 4) **결과**

* 로그인 사용자만 글 작성 가능
* 비로그인 사용자 요청은 401 에러 처리

---

**다음 단계는 `61. 인터셉터(HandlerInterceptor)로 로그인 공통 검사` 입니다. 진행할까요?**
