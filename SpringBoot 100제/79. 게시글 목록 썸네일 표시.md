### 79. 게시글 목록 + 첨부파일 썸네일 표시 (이미지형)

---

#### 1) **목표**

* 게시글 목록 조회 시 첨부파일 중 **이미지 파일**을 대표 썸네일로 표시
* 이미지가 없는 경우 `null` 반환

---

#### 2) **DB 조회 전략**

* `board_file`에서 `image/*` 확장자(`jpg`, `png`, `gif` 등) 파일 중 첫 번째 파일을 대표 썸네일로 선택
* SQL에서 `LIMIT 1` 사용

---

#### 3) **DTO**

**경로**: `src/main/java/com/example/springbootstart/dto/BoardWithThumbnailDto.java`

```java
package com.example.springbootstart.dto;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class BoardWithThumbnailDto {
    private Long id;
    private String title;
    private String content;
    private String createdAt;
    private String updatedAt;
    private String thumbnailPath; // 썸네일 이미지 경로
}
```

---

#### 4) **Mapper 인터페이스**

**경로**: `src/main/java/com/example/springbootstart/mapper/BoardMapper.java`

```java
List<BoardWithThumbnailDto> findBoardsWithThumbnail();
```

---

#### 5) **Mapper XML**

**경로**: `src/main/resources/mapper/BoardMapper.xml`

```xml
<select id="findBoardsWithThumbnail" resultType="com.example.springbootstart.dto.BoardWithThumbnailDto">
    SELECT b.id, b.title, b.content, b.created_at AS createdAt, b.updated_at AS updatedAt,
           (
             SELECT bf.file_path
             FROM board_file bf
             WHERE bf.board_id = b.id
             AND (bf.file_name LIKE '%.jpg' OR bf.file_name LIKE '%.png' OR bf.file_name LIKE '%.gif')
             ORDER BY bf.id ASC LIMIT 1
           ) AS thumbnailPath
    FROM board b
    ORDER BY b.id DESC
</select>
```

---

#### 6) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/BoardService.java`

```java
import com.example.springbootstart.dto.BoardWithThumbnailDto;

public List<BoardWithThumbnailDto> getBoardsWithThumbnail() {
    return boardMapper.findBoardsWithThumbnail();
}
```

---

#### 7) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/BoardController.java`

```java
@GetMapping("/with-thumbnail")
public ResponseEntity<?> getBoardsWithThumbnail() {
    return ResponseEntity.ok(boardService.getBoardsWithThumbnail());
}
```

---

#### 8) **테스트**

**GET 요청**

```
GET /boards/with-thumbnail
```

**응답(JSON 예시)**

```json
[
  {
    "id": 10,
    "title": "게시글 10",
    "content": "내용",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00",
    "thumbnailPath": "files/uuid_image1.jpg"
  },
  {
    "id": 9,
    "title": "게시글 9",
    "content": "내용",
    "createdAt": "2025-08-03T11:30:00",
    "updatedAt": "2025-08-03T11:30:00",
    "thumbnailPath": null
  }
]
```

* **이미지 없는 게시글** → `thumbnailPath=null`

---

#### 9) **프론트엔드 활용**

* `thumbnailPath != null`이면 `<img src="/files/..."/>` 표시
* 없으면 기본 이미지(`no-image.png`) 사용 가능

---

### 결과

* 게시글 목록에서 썸네일 표시 가능
* 대표 이미지가 없는 경우 자동 처리

---

**다음 단계는 `80. 이미지 썸네일 자동 생성(리사이즈)` 입니다. 진행할까요?**
