### 37. 예외 처리 (ExceptionHandler)

---

#### 1) **목표**

* API에서 발생하는 예외(Validation, NullPointer 등)를 **공통적으로 처리**
* 응답 포맷을 일관되게 유지 (JSON 형태)

---

#### 2) **GlobalExceptionHandler 클래스 추가**

**파일 경로**: `src/main/java/com/example/springbootstart/exception/GlobalExceptionHandler.java`

```java
package com.example.springbootstart.exception;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;

import java.util.HashMap;
import java.util.Map;

@ControllerAdvice   // 모든 Controller의 예외를 처리
public class GlobalExceptionHandler {

    // Validation 실패 예외 처리
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<?> handleValidationExceptions(MethodArgumentNotValidException ex) {
        Map<String, String> errors = new HashMap<>();
        for (FieldError error : ex.getBindingResult().getFieldErrors()) {
            errors.put(error.getField(), error.getDefaultMessage());
        }
        return ResponseEntity.badRequest().body(errors);
    }

    // NullPointerException 처리 예시
    @ExceptionHandler(NullPointerException.class)
    public ResponseEntity<?> handleNullPointerException(NullPointerException ex) {
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(Map.of("error", "NullPointerException 발생", "message", ex.getMessage()));
    }

    // 기타 예외 처리
    @ExceptionHandler(Exception.class)
    public ResponseEntity<?> handleException(Exception ex) {
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(Map.of("error", "예기치 못한 오류", "message", ex.getMessage()));
    }
}
```

---

#### 3) **테스트 (Validation 오류)**

**POST 요청**:

```json
{
  "name": "",
  "age": 0,
  "email": "not-email"
}
```

**응답(JSON)**

```json
{
  "name": "이름은 필수 입력 값입니다.",
  "age": "나이는 1 이상이어야 합니다.",
  "email": "올바른 이메일 형식이 아닙니다."
}
```

---

#### 4) **테스트 (NullPointerException 강제 발생)**

Controller에 테스트 코드 추가:

```java
@GetMapping("/error-test")
public String errorTest() {
    String str = null;
    return str.toString(); // NullPointerException 발생
}
```

**응답(JSON)**

```json
{
  "error": "NullPointerException 발생",
  "message": "Cannot invoke \"String.toString()\" because \"str\" is null"
}
```

---

#### 5) **장점**

* 예외 처리 로직 **한 곳에서 집중 관리**
* 코드 가독성 향상 및 유지보수 편리

---

**다음 단계는 `38. ResponseEntity 활용 응답 처리` 입니다. 진행할까요?**
