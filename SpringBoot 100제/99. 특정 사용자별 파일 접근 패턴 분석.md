### 99. 특정 사용자별 파일 접근 패턴 분석

---

#### 1) **목표**

* 특정 사용자 ID를 기준으로 최근 30일간 **파일 접근 패턴** 분석
* **파일별 접근 횟수** 제공 (많이 접근한 파일 순으로 정렬)

---

#### 2) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import java.util.List;
import java.util.Map;

List<Map<String, Object>> findUserFileAccessPattern(Long userId);
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findUserFileAccessPattern" parameterType="long" resultType="map">
    SELECT file_id, COUNT(*) AS accessCount
    FROM file_access_log
    WHERE user_id = #{userId}
      AND access_time >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
    GROUP BY file_id
    ORDER BY accessCount DESC;
</select>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
public List<Map<String, Object>> getUserFileAccessPattern(Long userId) {
    return logMapper.findUserFileAccessPattern(userId);
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/stats/user/{userId}")
public ResponseEntity<List<Map<String, Object>>> getUserFileAccessPattern(@PathVariable Long userId) {
    return ResponseEntity.ok(logService.getUserFileAccessPattern(userId));
}
```

---

#### 5) **프론트엔드 예시 (React + Chart.js Horizontal Bar)**

```javascript
import { useEffect, useState } from "react";
import { Bar } from "react-chartjs-2";

function UserAccessPattern({ userId }) {
  const [chartData, setChartData] = useState({});

  useEffect(() => {
    fetch(`/file-access-logs/stats/user/${userId}`)
      .then(res => res.json())
      .then(data => {
        setChartData({
          labels: data.map(d => `File ${d.file_id}`),
          datasets: [
            {
              label: "접근 횟수",
              data: data.map(d => d.accessCount),
              backgroundColor: "rgba(153,102,255,0.6)"
            }
          ]
        });
      });
  }, [userId]);

  return <Bar data={chartData} options={{ indexAxis: 'y' }} />;
}
export default UserAccessPattern;
```

---

#### 6) **테스트**

**GET 요청**

```
GET /file-access-logs/stats/user/5
```

**응답 예시**

```json
[
  { "file_id": 10, "accessCount": 12 },
  { "file_id": 11, "accessCount": 8 },
  { "file_id": 20, "accessCount": 5 }
]
```

→ React 차트에서 가로 막대 그래프로 사용자별 접근 파일 순위 표시

---

### 결과

* 특정 사용자의 파일 접근 패턴 분석 가능
* 사용자별 자주 사용하는 파일 파악 및 보안 모니터링 활용 가능

---

**다음 단계는 `100. 전체 파일 접근 분석 리포트 자동 생성(PDF)` 입니다. 진행할까요?**
