### 100. ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸ ìë™ ìƒì„± (PDF)

---

#### 1) **ëª©í‘œ**

* ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë°ì´í„°ë¥¼ ìš”ì•½í•˜ì—¬ **PDF ë¦¬í¬íŠ¸**ë¡œ ìë™ ìƒì„±
* ì£¼ìš” ë°ì´í„°:

  * ìµœê·¼ 30ì¼ ì´ ì ‘ê·¼ ìˆ˜
  * Top 5 ì‚¬ìš©ì
  * Top 5 íŒŒì¼
  * ìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰ ê·¸ë˜í”„

---

#### 2) **ì˜ì¡´ì„± ì¶”ê°€**

**pom.xml**

```xml
<dependency>
    <groupId>com.itextpdf</groupId>
    <artifactId>itext7-core</artifactId>
    <version>7.2.5</version>
</dependency>
```

> **iText7**: PDF ë¬¸ì„œ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
### 100. ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸ ìë™ ìƒì„± (PDF)

---

#### 1) **ëª©í‘œ**

* ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë°ì´í„°ë¥¼ ìš”ì•½í•˜ì—¬ **PDF ë¦¬í¬íŠ¸**ë¡œ ìë™ ìƒì„±
* ì£¼ìš” ë°ì´í„°:

  * ìµœê·¼ 30ì¼ ì´ ì ‘ê·¼ ìˆ˜
  * Top 5 ì‚¬ìš©ì
  * Top 5 íŒŒì¼
  * ìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰ ê·¸ë˜í”„

---

#### 2) **ì˜ì¡´ì„± ì¶”ê°€**

**pom.xml**

```xml
<dependency>
    <groupId>com.itextpdf</groupId>
    <artifactId>itext7-core</artifactId>
    <version>7.2.5</version>
</dependency>
```

> **iText7**: PDF ë¬¸ì„œ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬

---

#### 3) **Service (ë¦¬í¬íŠ¸ ìƒì„±)**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
import com.itextpdf.kernel.pdf.*;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.element.*;
import com.itextpdf.layout.property.UnitValue;
import org.springframework.core.io.ByteArrayResource;

public ResponseEntity<ByteArrayResource> generatePdfReport() throws IOException {
    // ë°ì´í„° ìˆ˜ì§‘
    int totalAccess = logMapper.countAccessLogs(null, null, null, null, null); // ì „ì²´ ë¡œê·¸ ìˆ˜
    List<Map<String, Object>> topUsers = logMapper.findTop10Users().subList(0, Math.min(5, logMapper.findTop10Users().size()));
    List<Map<String, Object>> topFiles = logMapper.findFileAccessStatsGlobalTop5(); // ìƒˆ ì¿¼ë¦¬ í•„ìš”
    List<Map<String, Object>> last7Days = logMapper.findAccessLogStatsLast7Days();

    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    PdfWriter writer = new PdfWriter(baos);
    PdfDocument pdf = new PdfDocument(writer);
    Document document = new Document(pdf);

    // ì œëª©
    document.add(new Paragraph("íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸").setBold().setFontSize(18));

    // ì´ ì ‘ê·¼ ìˆ˜
    document.add(new Paragraph("ìµœê·¼ 30ì¼ ì´ ì ‘ê·¼ ìˆ˜: " + totalAccess));

    // Top 5 ì‚¬ìš©ì
    document.add(new Paragraph("\nTop 5 ì‚¬ìš©ì"));
    Table userTable = new Table(UnitValue.createPercentArray(new float[]{2, 2})).useAllAvailableWidth();
    userTable.addHeaderCell("User ID");
    userTable.addHeaderCell("Access Count");
    for (Map<String, Object> user : topUsers) {
        userTable.addCell(user.get("user_id").toString());
        userTable.addCell(user.get("accessCount").toString());
    }
    document.add(userTable);

    // Top 5 íŒŒì¼
    document.add(new Paragraph("\nTop 5 íŒŒì¼"));
    Table fileTable = new Table(UnitValue.createPercentArray(new float[]{2, 2})).useAllAvailableWidth();
    fileTable.addHeaderCell("File ID");
    fileTable.addHeaderCell("Access Count");
    for (Map<String, Object> file : topFiles) {
        fileTable.addCell(file.get("file_id").toString());
        fileTable.addCell(file.get("count").toString());
    }
    document.add(fileTable);

    // ìµœê·¼ 7ì¼ ë°ì´í„° (í…ìŠ¤íŠ¸ ê¸°ë°˜, ê·¸ë˜í”„ ì´ë¯¸ì§€ëŠ” ì°¨íŠ¸ API ì‚¬ìš© ì‹œ ì¶”ê°€ ê°€ëŠ¥)
    document.add(new Paragraph("\nìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰"));
    for (Map<String, Object> d : last7Days) {
        document.add(new Paragraph(d.get("date") + " : " + d.get("count")));
    }

    document.close();

    ByteArrayResource resource = new ByteArrayResource(baos.toByteArray());
    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"file_access_report.pdf\"")
            .contentType(MediaType.APPLICATION_PDF)
            .contentLength(resource.contentLength())
            .body(resource);
}
```

---

#### 4) **Mapper (Top 5 íŒŒì¼ ì¶”ê°€)**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
List<Map<String, Object>> findFileAccessStatsGlobalTop5();
```

**ê²½ë¡œ**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findFileAccessStatsGlobalTop5" resultType="map">
    SELECT file_id, COUNT(*) AS count
    FROM file_access_log
    GROUP BY file_id
    ORDER BY count DESC
    LIMIT 5;
</select>
```

---

#### 5) **Controller**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/report/pdf")
public ResponseEntity<ByteArrayResource> getPdfReport() throws IOException {
    return logService.generatePdfReport();
}
```

---

#### 6) **í…ŒìŠ¤íŠ¸**

**GET ìš”ì²­**

```
GET /file-access-logs/report/pdf
```

**ê²°ê³¼**

* PDF ë‹¤ìš´ë¡œë“œ: `file_access_report.pdf`
* PDF ë‚´ìš©:

  * ì œëª©, ì´ ì ‘ê·¼ ìˆ˜
  * Top 5 ì‚¬ìš©ì í‘œ
  * Top 5 íŒŒì¼ í‘œ
  * ìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰(í…ìŠ¤íŠ¸)

---

### ê²°ê³¼

* ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ PDFë¡œ ìë™ ìƒì„±
* ê´€ë¦¬ì/ë³´ì•ˆ ê°ì‚¬ìš©ìœ¼ë¡œ í™œìš© ê°€ëŠ¥

---

Spring Boot ì‹œì‘í•˜ê¸° ì˜ˆì‹œ 100ì œ **ì™„ë£Œí–ˆìŠµë‹ˆë‹¤** ğŸ‰
í•„ìš”í•˜ë©´ **Zip íŒŒì¼** ë˜ëŠ” **md íŒŒì¼**ë¡œ ì „ì²´ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?

---

#### 3) **Service (ë¦¬í¬íŠ¸ ìƒì„±)**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
import com.itextpdf.kernel.pdf.*;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.element.*;
import com.itextpdf.layout.property.UnitValue;
import org.springframework.core.io.ByteArrayResource;

public ResponseEntity<ByteArrayResource> generatePdfReport() throws IOException {
    // ë°ì´í„° ìˆ˜ì§‘
    int totalAccess = logMapper.countAccessLogs(null, null, null, null, null); // ì „ì²´ ë¡œê·¸ ìˆ˜
    List<Map<String, Object>> topUsers = logMapper.findTop10Users().subList(0, Math.min(5, logMapper.findTop10Users().size()));
    List<Map<String, Object>> topFiles = logMapper.findFileAccessStatsGlobalTop5(); // ìƒˆ ì¿¼ë¦¬ í•„ìš”
    List<Map<String, Object>> last7Days = logMapper.findAccessLogStatsLast7Days();

    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    PdfWriter writer = new PdfWriter(baos);
    PdfDocument pdf = new PdfDocument(writer);
    Document document = new Document(pdf);

    // ì œëª©
    document.add(new Paragraph("íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸").setBold().setFontSize(18));

    // ì´ ì ‘ê·¼ ìˆ˜
    document.add(new Paragraph("ìµœê·¼ 30ì¼ ì´ ì ‘ê·¼ ìˆ˜: " + totalAccess));

    // Top 5 ì‚¬ìš©ì
    document.add(new Paragraph("\nTop 5 ì‚¬ìš©ì"));
    Table userTable = new Table(UnitValue.createPercentArray(new float[]{2, 2})).useAllAvailableWidth();
    userTable.addHeaderCell("User ID");
    userTable.addHeaderCell("Access Count");
    for (Map<String, Object> user : topUsers) {
        userTable.addCell(user.get("user_id").toString());
        userTable.addCell(user.get("accessCount").toString());
    }
    document.add(userTable);

    // Top 5 íŒŒì¼
    document.add(new Paragraph("\nTop 5 íŒŒì¼"));
    Table fileTable = new Table(UnitValue.createPercentArray(new float[]{2, 2})).useAllAvailableWidth();
    fileTable.addHeaderCell("File ID");
    fileTable.addHeaderCell("Access Count");
    for (Map<String, Object> file : topFiles) {
        fileTable.addCell(file.get("file_id").toString());
        fileTable.addCell(file.get("count").toString());
    }
    document.add(fileTable);

    // ìµœê·¼ 7ì¼ ë°ì´í„° (í…ìŠ¤íŠ¸ ê¸°ë°˜, ê·¸ë˜í”„ ì´ë¯¸ì§€ëŠ” ì°¨íŠ¸ API ì‚¬ìš© ì‹œ ì¶”ê°€ ê°€ëŠ¥)
    document.add(new Paragraph("\nìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰"));
    for (Map<String, Object> d : last7Days) {
        document.add(new Paragraph(d.get("date") + " : " + d.get("count")));
    }

    document.close();

    ByteArrayResource resource = new ByteArrayResource(baos.toByteArray());
    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"file_access_report.pdf\"")
            .contentType(MediaType.APPLICATION_PDF)
            .contentLength(resource.contentLength())
            .body(resource);
}
```

---

#### 4) **Mapper (Top 5 íŒŒì¼ ì¶”ê°€)**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
List<Map<String, Object>> findFileAccessStatsGlobalTop5();
```

**ê²½ë¡œ**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findFileAccessStatsGlobalTop5" resultType="map">
    SELECT file_id, COUNT(*) AS count
    FROM file_access_log
    GROUP BY file_id
    ORDER BY count DESC
    LIMIT 5;
</select>
```

---

#### 5) **Controller**

**ê²½ë¡œ**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/report/pdf")
public ResponseEntity<ByteArrayResource> getPdfReport() throws IOException {
    return logService.generatePdfReport();
}
```

---

#### 6) **í…ŒìŠ¤íŠ¸**

**GET ìš”ì²­**

```
GET /file-access-logs/report/pdf
```

**ê²°ê³¼**

* PDF ë‹¤ìš´ë¡œë“œ: `file_access_report.pdf`
* PDF ë‚´ìš©:

  * ì œëª©, ì´ ì ‘ê·¼ ìˆ˜
  * Top 5 ì‚¬ìš©ì í‘œ
  * Top 5 íŒŒì¼ í‘œ
  * ìµœê·¼ 7ì¼ ì¼ë³„ ì ‘ê·¼ëŸ‰(í…ìŠ¤íŠ¸)

---

### ê²°ê³¼

* ì „ì²´ íŒŒì¼ ì ‘ê·¼ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ PDFë¡œ ìë™ ìƒì„±
* ê´€ë¦¬ì/ë³´ì•ˆ ê°ì‚¬ìš©ìœ¼ë¡œ í™œìš© ê°€ëŠ¥

---

Spring Boot ì‹œì‘í•˜ê¸° ì˜ˆì‹œ 100ì œ **ì™„ë£Œí–ˆìŠµë‹ˆë‹¤** ğŸ‰
í•„ìš”í•˜ë©´ **Zip íŒŒì¼** ë˜ëŠ” **md íŒŒì¼**ë¡œ ì „ì²´ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?
