### 98. 특정 파일별 접근 빈도 분석

---

#### 1) **목표**

* 특정 파일 ID를 기준으로 **최근 30일간 일별 접근 횟수** 제공
* 다운로드 / 복원 통합 접근량 분석

---

#### 2) **Mapper**

**경로**: `src/main/java/com/example/springbootstart/mapper/FileAccessLogMapper.java`

```java
import java.util.List;
import java.util.Map;

List<Map<String, Object>> findFileAccessStatsByFileId(Long fileId);
```

**경로**: `src/main/resources/mapper/FileAccessLogMapper.xml`

```xml
<select id="findFileAccessStatsByFileId" parameterType="long" resultType="map">
    SELECT DATE(access_time) AS date,
           COUNT(*) AS count
    FROM file_access_log
    WHERE file_id = #{fileId}
      AND access_time >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
    GROUP BY DATE(access_time)
    ORDER BY date ASC;
</select>
```

---

#### 3) **Service**

**경로**: `src/main/java/com/example/springbootstart/service/FileAccessLogService.java`

```java
public List<Map<String, Object>> getFileAccessStats(Long fileId) {
    return logMapper.findFileAccessStatsByFileId(fileId);
}
```

---

#### 4) **Controller**

**경로**: `src/main/java/com/example/springbootstart/controller/FileAccessLogController.java`

```java
@GetMapping("/stats/file/{fileId}")
public ResponseEntity<List<Map<String, Object>>> getFileStats(@PathVariable Long fileId) {
    return ResponseEntity.ok(logService.getFileAccessStats(fileId));
}
```

---

#### 5) **프론트엔드 예시 (React + Chart.js)**

```javascript
import { useEffect, useState } from "react";
import { Line } from "react-chartjs-2";

function FileAccessChart({ fileId }) {
  const [chartData, setChartData] = useState({});

  useEffect(() => {
    fetch(`/file-access-logs/stats/file/${fileId}`)
      .then(res => res.json())
      .then(data => {
        setChartData({
          labels: data.map(d => d.date),
          datasets: [
            {
              label: "접근 횟수",
              data: data.map(d => d.count),
              borderColor: "orange",
              fill: false
            }
          ]
        });
      });
  }, [fileId]);

  return <Line data={chartData} />;
}
export default FileAccessChart;
```

---

#### 6) **테스트**

**GET 요청**

```
GET /file-access-logs/stats/file/10
```

**응답 예시**

```json
[
  { "date": "2025-07-10", "count": 3 },
  { "date": "2025-07-11", "count": 5 },
  { "date": "2025-07-12", "count": 2 }
]
```

→ React 차트에 일별 접근량 그래프 표시

---

### 결과

* 특정 파일의 최근 30일간 접근 빈도를 시각화할 수 있는 API 구현
* 파일별 사용 추세 분석 가능

---

**다음 단계는 `99. 특정 사용자별 파일 접근 패턴 분석` 입니다. 진행할까요?**
