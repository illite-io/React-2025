### 47. 댓글 조회 API (게시글 기준)

---

#### 1) **목표**

* 특정 게시글의 댓글 목록 조회 API 작성
* 게시글 ID 기준으로 `comment` 테이블에서 데이터 조회

---

#### 2) **Mapper 인터페이스 수정**

**경로**: `src/main/java/com/example/springbootstart/mapper/CommentMapper.java`

```java
package com.example.springbootstart.mapper;

import com.example.springbootstart.dto.CommentDto;
import org.apache.ibatis.annotations.Mapper;
import java.util.List;

@Mapper
public interface CommentMapper {
    int insertComment(CommentDto commentDto);

    // 게시글 기준 댓글 목록 조회
    List<CommentDto> findCommentsByBoardId(Long boardId);
}
```

---

#### 3) **Mapper XML 수정**

**경로**: `src/main/resources/mapper/CommentMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.springbootstart.mapper.CommentMapper">

    <insert id="insertComment" parameterType="com.example.springbootstart.dto.CommentDto">
        INSERT INTO comment (board_id, user_id, content)
        VALUES (#{boardId}, #{userId}, #{content})
    </insert>

    <!-- 특정 게시글 댓글 목록 조회 -->
    <select id="findCommentsByBoardId" parameterType="long"
            resultType="com.example.springbootstart.dto.CommentDto">
        SELECT id, board_id AS boardId, user_id AS userId, content,
               created_at AS createdAt, updated_at AS updatedAt
        FROM comment
        WHERE board_id = #{boardId}
        ORDER BY id DESC
    </select>
</mapper>
```

---

#### 4) **Service 수정**

**경로**: `src/main/java/com/example/springbootstart/service/CommentService.java`

```java
package com.example.springbootstart.service;

import com.example.springbootstart.dto.CommentDto;
import com.example.springbootstart.mapper.CommentMapper;
import org.springframework.stereotype.Service;
import java.util.List;

@Service
public class CommentService {
    private final CommentMapper commentMapper;

    public CommentService(CommentMapper commentMapper) {
        this.commentMapper = commentMapper;
    }

    public int createComment(CommentDto commentDto) {
        return commentMapper.insertComment(commentDto);
    }

    // 특정 게시글 댓글 조회
    public List<CommentDto> getCommentsByBoardId(Long boardId) {
        return commentMapper.findCommentsByBoardId(boardId);
    }
}
```

---

#### 5) **Controller 수정**

**경로**: `src/main/java/com/example/springbootstart/controller/CommentController.java`

```java
package com.example.springbootstart.controller;

import com.example.springbootstart.dto.CommentDto;
import com.example.springbootstart.service.CommentService;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/comments")
public class CommentController {

    private final CommentService commentService;
    public CommentController(CommentService commentService) {
        this.commentService = commentService;
    }

    @PostMapping
    public ResponseEntity<?> createComment(@RequestBody CommentDto commentDto) {
        int result = commentService.createComment(commentDto);
        return result == 1 ? ResponseEntity.ok("댓글 등록 성공")
                           : ResponseEntity.badRequest().body("댓글 등록 실패");
    }

    // 게시글 기준 댓글 목록 조회
    @GetMapping("/board/{boardId}")
    public List<CommentDto> getCommentsByBoardId(@PathVariable Long boardId) {
        return commentService.getCommentsByBoardId(boardId);
    }
}
```

---

#### 6) **테스트 요청**

**GET 요청**

```
http://localhost:8080/comments/board/1
```

**응답(JSON 예시)**

```json
[
  {
    "id": 3,
    "boardId": 1,
    "userId": 2,
    "content": "새로운 댓글입니다.",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00"
  },
  {
    "id": 1,
    "boardId": 1,
    "userId": 1,
    "content": "첫 댓글입니다. 반갑습니다.",
    "createdAt": "2025-08-03T12:00:00",
    "updatedAt": "2025-08-03T12:00:00"
  }
]
```

---

#### 7) **결과**

* 특정 게시글의 댓글 목록을 정상적으로 조회할 수 있음

---

**다음 단계는 `48. 댓글 수정 API` 입니다. 진행할까요?**
