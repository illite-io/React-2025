ì¢‹ì•„ìš”! ì´ë²ˆì—ëŠ” **React Queryì™€ í•¨ê»˜ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ë™ê¸°í™”**í•˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ë“œë¦´ê²Œìš”.

React Queryë¥¼ ì‚¬ìš©í•˜ë©´ ë¡œê·¸ì¸ ìƒíƒœì™€ ì‚¬ìš©ì ì •ë³´ë¥¼ **ì„œë²„ ìƒíƒœë¡œ ê´€ë¦¬**í•  ìˆ˜ ìˆì–´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìƒê¹ë‹ˆë‹¤:

âœ… ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
âœ… ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì‹œ ê´€ë ¨ ìºì‹œ ìë™ ê°±ì‹  ë˜ëŠ” ì´ˆê¸°í™”
âœ… ì„œë²„ì˜ ìƒíƒœ ë³€í™”ê°€ ì¦‰ì‹œ ë°˜ì˜ë¨

---

# âœ… React Queryë¡œ ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬í•˜ê¸°

---

## ğŸ“¦ ì£¼ìš” íë¦„

1. ë¡œê·¸ì¸ í›„ í† í° ì €ì¥
2. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ APIë¥¼ `useQuery`ë¡œ ìš”ì²­
3. `logout` ì‹œ ìºì‹œ ì´ˆê¸°í™” â†’ ìƒíƒœ ë¦¬ì…‹
4. ì „ì—­ ì‚¬ìš©ì ìƒíƒœ = `useQuery`ì˜ ë°ì´í„°

---

## ğŸ“ í´ë” êµ¬ì„± ì˜ˆì‹œ

```
/src
 â”œâ”€â”€ /api
 â”‚   â”œâ”€â”€ auth.ts          â† ë¡œê·¸ì¸ API
 â”‚   â””â”€â”€ user.ts          â† ì‚¬ìš©ì ì •ë³´ API
 â”œâ”€â”€ /hooks
 â”‚   â””â”€â”€ useUser.ts       â† ì‚¬ìš©ì ì •ë³´ í›…
 â”œâ”€â”€ /contexts
 â”‚   â””â”€â”€ AuthContext.tsx  â† í† í° ê´€ë¦¬ + React Query í†µí•©
 â””â”€â”€ App.tsx
```

---

## âœ… 1. ë¡œê·¸ì¸ API (ğŸ“„ `/api/auth.ts`)

```ts
import axios from 'axios';

export const login = async (username: string, password: string) => {
  const res = await axios.post('http://localhost:3001/login', {
    username,
    password,
  });
  return res.data; // { user, token }
};
```

---

## âœ… 2. ì‚¬ìš©ì ì •ë³´ API (ğŸ“„ `/api/user.ts`)

```ts
import axios from './axios'; // ì¸í„°ì…‰í„° ì ìš©ëœ axios

export const fetchUser = async () => {
  const res = await axios.get('/me'); // ì˜ˆ: /me ë˜ëŠ” /users/1
  return res.data;
};
```

---

## âœ… 3. ì‚¬ìš©ì ì •ë³´ ì¿¼ë¦¬ í›… (ğŸ“„ `/hooks/useUser.ts`)

```ts
import { useQuery } from '@tanstack/react-query';
import { fetchUser } from '../api/user';

export const useUser = () => {
  return useQuery(['user'], fetchUser, {
    enabled: !!localStorage.getItem('token'), // ë¡œê·¸ì¸í•œ ê²½ìš°ë§Œ ìš”ì²­
    staleTime: 1000 * 60 * 5, // 5ë¶„ ìºì‹œ ìœ ì§€
  });
};
```

---

## âœ… 4. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ (ğŸ“„ `/contexts/AuthContext.tsx`)

```tsx
import { createContext, useContext } from 'react';
import { useQueryClient } from '@tanstack/react-query';

const AuthContext = createContext<any>(null);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const queryClient = useQueryClient();

  const login = (token: string) => {
    localStorage.setItem('token', token);
    queryClient.invalidateQueries(['user']); // âœ… ì‚¬ìš©ì ì •ë³´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  };

  const logout = () => {
    localStorage.removeItem('token');
    queryClient.clear(); // âœ… ëª¨ë“  ìºì‹œ ì´ˆê¸°í™”
  };

  return (
    <AuthContext.Provider value={{ login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
```

---

## âœ… 5. ì‚¬ìš©ì ì •ë³´ ì‚¬ìš© (ğŸ“„ `/components/Profile.tsx`)

```tsx
import { useUser } from '../hooks/useUser';

const Profile = () => {
  const { data, isLoading, error } = useUser();

  if (isLoading) return <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>;
  if (error) return <p>ì—ëŸ¬ ë°œìƒ</p>;

  return (
    <div>
      <h2>í™˜ì˜í•©ë‹ˆë‹¤, {data.name} ë‹˜</h2>
      <p>{data.email}</p>
    </div>
  );
};
```

---

## âœ… ìš”ì•½

| í•­ëª©        | ì„¤ëª…                                       |
| --------- | ---------------------------------------- |
| ë¡œê·¸ì¸ ì„±ê³µ    | í† í° ì €ì¥ + `invalidateQueries(['user'])` í˜¸ì¶œ |
| ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬ | `useQuery(['user'], fetchUser)`          |
| ë¡œê·¸ì•„ì›ƒ      | í† í° ì œê±° + `queryClient.clear()`            |

---

## âœ… ì¥ì 

| í•­ëª©       | ì´ì                      |
| -------- | ---------------------- |
| ìë™ ìºì‹±    | ì¬ìš”ì²­ ì¤„ì´ê³  ë¹ ë¥¸ ì‘ë‹µ ê°€ëŠ¥       |
| ìƒíƒœ ë™ê¸°í™”   | ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ í›„ UI ìë™ ê°±ì‹     |
| ì—ëŸ¬ ì²˜ë¦¬ ì‰¬ì›€ | `useQuery`ì—ì„œ ì—ëŸ¬ ì§ì ‘ í•¸ë“¤ë§ |

---

## ğŸ‘‰ ë‹¤ìŒ ì¶”ì²œ ì£¼ì œ

* âœ… React Query `useMutation`ìœ¼ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬
* âœ… `React Query Devtools`ë¡œ ìƒíƒœ í™•ì¸
* âœ… useAuth í›…ê³¼ React Query ê²°í•© ìµœì  êµ¬ì¡° ë§Œë“¤ê¸°

ê³„ì† ë³´ì‹œë ¤ë©´ `"ë‹¤ìŒ"`ì´ë¼ê³  ì…ë ¥í•´ì£¼ì„¸ìš”!
