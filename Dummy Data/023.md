ì¢‹ì•„ìš”! ì´ë²ˆì—ëŠ” **`useAuth` ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ Context + React Queryë¥¼ í†µí•©**í•˜ëŠ” ìµœì  êµ¬ì¡°ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš”.
ì§€ê¸ˆê¹Œì§€ ë§Œë“  ë¡œê·¸ì¸ íë¦„, ì‚¬ìš©ì ì •ë³´ fetch, í† í° ì €ì¥, ë¡œê·¸ì•„ì›ƒ ë“±ì„ í•˜ë‚˜ì˜ `useAuth` í›…ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ë¬¶ì–´ ì „ì—­ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

---

# âœ… ëª©í‘œ

* `useAuth()` í•˜ë‚˜ë¡œ ë¡œê·¸ì¸ ìƒíƒœ, ì‚¬ìš©ì ì •ë³´, login/logout í•¨ìˆ˜ ëª¨ë‘ ì ‘ê·¼
* ë‚´ë¶€ì ìœ¼ë¡œ React Query + Context í™œìš©
* ì•± ì–´ë””ì„œë‚˜ ì¸ì¦ ìƒíƒœ ì‰½ê²Œ í™•ì¸ ë° ì²˜ë¦¬ ê°€ëŠ¥

---

## ğŸ“ í´ë” êµ¬ì¡° ì˜ˆì‹œ

```
/src
 â”œâ”€â”€ /api
 â”‚   â””â”€â”€ auth.ts
 â”œâ”€â”€ /hooks
 â”‚   â””â”€â”€ useAuth.ts         â† ìµœì¢… í†µí•© í›…
 â”œâ”€â”€ /components
 â”‚   â””â”€â”€ LogoutButton.tsx
 â””â”€â”€ App.tsx
```

---

## âœ… 1. ë¡œê·¸ì¸ API + ì‚¬ìš©ì ì •ë³´ API (ë³µìŠµ)

```ts
// /api/auth.ts
import axios from './axios';

export const loginApi = (username: string, password: string) =>
  axios.post('/login', { username, password }).then(res => res.data);

export const fetchUser = () =>
  axios.get('/me').then(res => res.data); // ì˜ˆ: /me ë˜ëŠ” /users/1
```

---

## âœ… 2. useAuth ì»¤ìŠ¤í…€ í›… (ğŸ“„ `/hooks/useAuth.ts`)

```tsx
import { useQuery, useQueryClient } from '@tanstack/react-query';
import { loginApi, fetchUser } from '../api/auth';
import { useNavigate } from 'react-router-dom';

export const useAuth = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  // âœ… ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const { data: user, isLoading, isError } = useQuery({
    queryKey: ['user'],
    queryFn: fetchUser,
    enabled: !!localStorage.getItem('token'), // ë¡œê·¸ì¸ ì‹œì—ë§Œ ìš”ì²­
    staleTime: 1000 * 60 * 5,
  });

  // âœ… ë¡œê·¸ì¸ ì²˜ë¦¬
  const login = async (username: string, password: string) => {
    const result = await loginApi(username, password);
    localStorage.setItem('token', result.token);
    await queryClient.invalidateQueries({ queryKey: ['user'] }); // ì‚¬ìš©ì ì •ë³´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    navigate('/'); // í™ˆ ë˜ëŠ” ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™
  };

  // âœ… ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
  const logout = () => {
    localStorage.removeItem('token');
    queryClient.clear(); // ìºì‹œ ì´ˆê¸°í™”
    navigate('/login');
  };

  return {
    user,
    isLoading,
    isError,
    isLoggedIn: !!user,
    login,
    logout,
  };
};
```

---

## âœ… 3. ì‚¬ìš© ì˜ˆì‹œ - LogoutButton.tsx

```tsx
import { useAuth } from '../hooks/useAuth';

const LogoutButton = () => {
  const { logout, user } = useAuth();

  return (
    <div>
      <p>{user?.name} ë‹˜</p>
      <button onClick={logout}>ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  );
};

export default LogoutButton;
```

---

## âœ… 4. ì‚¬ìš© ì˜ˆì‹œ - ë¡œê·¸ì¸ í¼

```tsx
import { useState } from 'react';
import { useAuth } from '../hooks/useAuth';

const LoginForm = () => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const { login } = useAuth();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await login(username, password);
    } catch (err: any) {
      alert(err?.response?.data?.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input value={username} onChange={(e) => setUsername(e.target.value)} />
      <input value={password} onChange={(e) => setPassword(e.target.value)} />
      <button type="submit">ë¡œê·¸ì¸</button>
    </form>
  );
};
```

---

## âœ… ì¥ì  ìš”ì•½

| í•­ëª©          | ì„¤ëª…                                              |
| ----------- | ----------------------------------------------- |
| `useAuth()` | ëª¨ë“  ì¸ì¦ ê¸°ëŠ¥ì„ í•˜ë‚˜ë¡œ ì œê³µ                                |
| ë‚´ë¶€ì ìœ¼ë¡œ       | React Query + localStorage ì—°ë™                   |
| ì™¸ë¶€ì—ì„œ        | ë¡œê·¸ì¸ ìƒíƒœ, ì‚¬ìš©ì, ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ì ‘ê·¼ ê°€ëŠ¥                      |
| ìƒíƒœ ê°±ì‹        | login â†’ invalidate â†’ ìë™ ìƒíƒœ ë°˜ì˜                   |
| ì¸ì¦ ë³´í˜¸       | `if (!isLoggedIn) navigate('/login')` ë“±ìœ¼ë¡œ í™œìš© ê°€ëŠ¥ |

---

## ğŸ‘‰ ë‹¤ìŒ ì¶”ì²œ ì£¼ì œ

* âœ… ë¡œê·¸ì¸ ì„±ê³µ ì‹œ toast ì•Œë¦¼, ì—ëŸ¬ UX ê°œì„ 
* âœ… ê´€ë¦¬ì ê¶Œí•œ/role ê¸°ë°˜ ì ‘ê·¼ ì œí•œ
* âœ… ë‹¤êµ­ì–´ ë¡œê·¸ì¸ í˜ì´ì§€ ë° ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬

ë³´ê³  ì‹¶ì€ í•­ëª© ì•Œë ¤ì£¼ì‹œê±°ë‚˜ `"ë‹¤ìŒ"`ì´ë¼ê³  ì…ë ¥í•´ì£¼ì„¸ìš”!
