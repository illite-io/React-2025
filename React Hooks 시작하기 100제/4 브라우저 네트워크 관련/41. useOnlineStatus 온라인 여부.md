좋습니다.
그럼 **React Hooks 시작하기 100제 – 41번 `useDarkMode` (다크모드 감지 및 토글)** 예제로 넘어가겠습니다.

---

## 41. `useDarkMode` – 다크모드 감지 및 토글

### 목적

* OS 환경설정(`prefers-color-scheme`)과 사용자의 수동 선택을 함께 처리
* 사용자 선택은 `localStorage`에 보존
* HTML 루트에 `class="dark"`를 토글해 Tailwind 등과 연동 가능

---

### 파일 경로: `src/hooks/useDarkMode.js`

```javascript
import { useCallback, useEffect, useMemo, useState } from 'react';

const STORAGE_KEY = 'color-scheme'; // 'light' | 'dark' | 'system'

/**
 * useDarkMode
 * - scheme: 'light' | 'dark' | 'system' (사용자 선택)
 * - isDark: 실제 적용된 다크 여부(boolean)
 * - toggle: light/dark 토글 (system 모드일 땐 dark<->light 전환하며 scheme을 고정값으로 바꿈)
 * - setScheme: 'light' | 'dark' | 'system' 중 직접 설정
 */
export default function useDarkMode() {
  const getInitialScheme = () => {
    if (typeof window === 'undefined') return 'system';
    try {
      return localStorage.getItem(STORAGE_KEY) || 'system';
    } catch {
      return 'system';
    }
  };

  const [scheme, setScheme] = useState(getInitialScheme);
  const prefersDark = useMemo(() => {
    if (typeof window === 'undefined' || !window.matchMedia) return false;
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  }, []);

  // 실제 적용 다크 여부 계산
  const isDark = scheme === 'system' ? prefersDark : scheme === 'dark';

  // html root에 class 토글 + 저장
  useEffect(() => {
    if (typeof document === 'undefined') return;

    const root = document.documentElement;
    root.classList.toggle('dark', isDark);

    try {
      localStorage.setItem(STORAGE_KEY, scheme);
    } catch {}
  }, [scheme, isDark]);

  // 시스템 환경설정 변경 감지
  useEffect(() => {
    if (typeof window === 'undefined' || !window.matchMedia) return;

    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    const listener = () => {
      // system 모드일 때만 시스템 변경을 반영
      if (scheme === 'system') {
        const root = document.documentElement;
        root.classList.toggle('dark', mq.matches);
      }
    };
    mq.addEventListener?.('change', listener);
    return () => mq.removeEventListener?.('change', listener);
  }, [scheme]);

  const toggle = useCallback(() => {
    // system이면 현재 적용 상태 기준으로 반대로 고정
    if (scheme === 'system') {
      setScheme(isDark ? 'light' : 'dark');
    } else {
      setScheme((prev) => (prev === 'dark' ? 'light' : 'dark'));
    }
  }, [scheme, isDark]);

  return { scheme, isDark, toggle, setScheme };
}
```

---

### 사용 예시

**파일 경로:** `src/App.js`

```javascript
import React from 'react';
import useDarkMode from './hooks/useDarkMode';

export default function App() {
  const { scheme, isDark, toggle, setScheme } = useDarkMode();

  const cardStyle = {
    padding: 16,
    borderRadius: 12,
    border: '1px solid',
    borderColor: isDark ? '#374151' : '#e5e7eb',
    background: isDark ? '#111827' : '#ffffff',
    color: isDark ? '#e5e7eb' : '#111827',
  };

  return (
    <div style={{ minHeight: '100vh', padding: 24, background: isDark ? '#0b1020' : '#f8fafc' }}>
      <h1>useDarkMode – 다크모드 감지 및 토글</h1>

      <div style={{ display: 'flex', gap: 8, marginBottom: 12 }}>
        <button onClick={toggle}>light/dark 토글</button>
        <button onClick={() => setScheme('light')}>light 고정</button>
        <button onClick={() => setScheme('dark')}>dark 고정</button>
        <button onClick={() => setScheme('system')}>system(OS 설정 따름)</button>
      </div>

      <p>현재 선택: <strong>{scheme}</strong></p>
      <p>실제 적용 모드: <strong>{isDark ? 'dark' : 'light'}</strong></p>

      <div style={{ marginTop: 16 }}>
        <div style={cardStyle}>
          <strong>카드 예시</strong>
          <p style={{ marginTop: 8 }}>루트 요소에 <code>class="dark"</code>가 적용되어 스타일을 전환합니다.</p>
        </div>
      </div>
    </div>
  );
}
```

---

### 핵심 포인트

* 사용자 선택(scheme)과 시스템 선호(prefers-color-scheme)를 분리하여 관리
* 실제 적용 여부는 `isDark`로 단일화해 UI 조건부 스타일에 사용
* 루트 `html`에 `dark` 클래스를 토글하면 Tailwind(`dark:` 프리픽스)나 CSS 변수 전략과 쉽게 연동

---

다음은 **42번 `useTheme` – 테마 객체 제공 및 변경** 예제로 이어가겠습니다. 계속 진행할까요?
