좋습니다.
그럼 **React Hooks 시작하기 100제 – 87번 `useLocalStorageState` (로컬 스토리지 동기화 상태)** 예제로 넘어가겠습니다.

---

## 87. `useLocalStorageState` – 로컬 스토리지 동기화

### 목적

* 상태 값을 `localStorage`에 저장/복원하여 새로고침 후에도 유지
* 직렬화/역직렬화(JSON)와 키 충돌, SSR, 스토리지 이벤트까지 안전하게 처리

---

### 파일 경로: `src/hooks/useLocalStorageState.js`

```javascript
import { useCallback, useEffect, useRef, useState } from 'react';

/**
 * useLocalStorageState
 * @param {string} key              로컬스토리지 키
 * @param {any|(()=>any)} initial   초기값(함수 가능)
 * @param {(v:any)=>string} serialize   값→문자열 (기본 JSON.stringify)
 * @param {(s:string)=>any} deserialize 문자열→값 (기본 JSON.parse)
 *
 * 반환: [state, setState, reset]
 */
export default function useLocalStorageState(
  key,
  initial,
  serialize = JSON.stringify,
  deserialize = JSON.parse
) {
  const isBrowser = typeof window !== 'undefined' && typeof localStorage !== 'undefined';
  const keyRef = useRef(key);

  const read = useCallback(() => {
    if (!isBrowser) return typeof initial === 'function' ? initial() : initial;
    try {
      const raw = localStorage.getItem(keyRef.current);
      if (raw === null) {
        return typeof initial === 'function' ? initial() : initial;
      }
      return deserialize(raw);
    } catch {
      // 파싱 실패 시 초기값으로 복구
      return typeof initial === 'function' ? initial() : initial;
    }
  }, [isBrowser, initial, deserialize]);

  const [state, setState] = useState(read);

  // key 변경 대응: 기존 키에서 새 키로 값 이동
  useEffect(() => {
    if (keyRef.current === key) return;
    // 이전 키의 값 삭제(선택)
    try {
      const prevKey = keyRef.current;
      const prev = localStorage.getItem(prevKey);
      if (prev !== null) {
        localStorage.removeItem(prevKey);
        localStorage.setItem(key, prev);
      }
    } catch {}
    keyRef.current = key;
  }, [key]);

  // state → localStorage 반영
  useEffect(() => {
    if (!isBrowser) return;
    try {
      localStorage.setItem(keyRef.current, serialize(state));
    } catch {
      // 용량 초과 등 에러 무시(옵션으로 콜백 추가 가능)
    }
  }, [state, serialize, isBrowser]);

  // 다른 탭에서 값 변경(sync)
  useEffect(() => {
    if (!isBrowser) return;
    const onStorage = (e) => {
      if (e.key !== keyRef.current) return;
      try {
        if (e.newValue == null) return;
        setState(deserialize(e.newValue));
      } catch {}
    };
    window.addEventListener('storage', onStorage);
    return () => window.removeEventListener('storage', onStorage);
  }, [deserialize, isBrowser]);

  const reset = useCallback(() => {
    const v = typeof initial === 'function' ? initial() : initial;
    setState(v);
    try {
      if (isBrowser) localStorage.setItem(keyRef.current, serialize(v));
    } catch {}
  }, [initial, serialize, isBrowser]);

  return [state, setState, reset];
}
```

---

### 사용 예시

**파일 경로:** `src/App.js`

```javascript
import React from 'react';
import useLocalStorageState from './hooks/useLocalStorageState';

export default function App() {
  const [name, setName, resetName] = useLocalStorageState('profile:name', '');
  const [theme, setTheme] = useLocalStorageState('ui:theme', 'light');

  return (
    <div style={{ padding: 24 }}>
      <h1>useLocalStorageState – 로컬 스토리지 동기화</h1>

      <label>
        이름:
        <input
          value={name}
          onChange={(e) => setName(e.target.value)}
          style={{ marginLeft: 8 }}
        />
      </label>
      <button onClick={resetName} style={{ marginLeft: 8 }}>초기화</button>

      <div style={{ marginTop: 12 }}>
        테마:
        <select value={theme} onChange={(e) => setTheme(e.target.value)} style={{ marginLeft: 8 }}>
          <option value="light">light</option>
          <option value="dark">dark</option>
          <option value="system">system</option>
        </select>
      </div>

      <p style={{ marginTop: 12, color: '#475569' }}>
        새로고침해도 유지됩니다. 다른 브라우저 탭에서 변경해도 실시간 반영됩니다.
      </p>
    </div>
  );
}
```

---

### 구현 포인트

* 초기값은 함수로 전달하면 최초 렌더에서만 평가되어 비용 절약
* key 변경 시 이전 스토리지 값을 새 키로 이전 처리
* `storage` 이벤트로 다중 탭 동기화 지원
* JSON 이외 포맷이 필요하면 `serialize/deserialize`를 주입
* SSR 환경에서는 `window`/`localStorage`가 없으므로 안전 가드 적용

---

다음은 **88번 `useSessionStorageState` – 세션 스토리지 동기화** 예제로 이어가겠습니다. 계속 진행할까요?
