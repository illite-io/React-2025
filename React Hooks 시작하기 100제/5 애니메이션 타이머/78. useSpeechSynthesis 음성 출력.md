좋습니다.
이미 37번에서 `useOnClickOutside`를 다뤘으므로, **중복을 피해서** 이번 회차는 \*\*78번 `useIdle` (사용자 유휴 상태 감지)\*\*로 진행하겠습니다.

---

## 78. `useIdle` – 사용자 유휴 상태 감지

### 목적

* 키보드/마우스/터치 등 입력이 **일정 시간 없음**을 감지해 유휴 상태로 전환
* 자동 로그아웃 경고, 폴링 중단, 애니메이션 일시정지 등에 활용

---

### 파일 경로: `src/hooks/useIdle.js`

```javascript
import { useCallback, useEffect, useRef, useState } from 'react';

/**
 * useIdle
 * @param {number} timeout 유휴로 간주할 무활동 시간(ms) (기본 60초)
 * @param {EventTarget} [target=window] 활동 이벤트를 들을 대상
 * @returns {{ idle: boolean, lastActive: number, reset: () => void }}
 */
export default function useIdle(timeout = 60_000, target = typeof window !== 'undefined' ? window : undefined) {
  const [idle, setIdle] = useState(false);
  const [lastActive, setLastActive] = useState(Date.now());
  const timerRef = useRef(null);

  const clearTimer = () => {
    if (timerRef.current) clearTimeout(timerRef.current);
    timerRef.current = null;
  };

  const schedule = useCallback(() => {
    clearTimer();
    timerRef.current = setTimeout(() => setIdle(true), timeout);
  }, [timeout]);

  const markActive = useCallback(() => {
    setIdle(false);
    setLastActive(Date.now());
    schedule();
  }, [schedule]);

  const reset = useCallback(() => {
    markActive();
  }, [markActive]);

  useEffect(() => {
    if (!target?.addEventListener) return;

    // 사용자 활동으로 간주할 이벤트 목록
    const events = [
      'mousemove', 'mousedown', 'keydown', 'wheel', 'touchstart', 'touchmove', 'scroll', 'visibilitychange'
    ];
    const handler = (e) => {
      // 탭이 다시 보일 때도 활성 처리
      if (e.type === 'visibilitychange' && document.visibilityState !== 'visible') return;
      markActive();
    };

    // 초기 스케줄
    schedule();

    events.forEach((ev) => target.addEventListener(ev, handler, { passive: true }));
    return () => {
      clearTimer();
      events.forEach((ev) => target.removeEventListener(ev, handler));
    };
  }, [target, schedule, markActive]);

  return { idle, lastActive, reset };
}
```

---

### 사용 예시

**파일 경로:** `src/App.js`

```javascript
import React, { useEffect, useState } from 'react';
import useIdle from './hooks/useIdle';

export default function App() {
  const { idle, lastActive, reset } = useIdle(10_000); // 10초 무활동이면 유휴
  const [tick, setTick] = useState(0);

  // 유휴 상태에서는 타이머 중단
  useEffect(() => {
    if (idle) return;
    const id = setInterval(() => setTick((t) => t + 1), 1000);
    return () => clearInterval(id);
  }, [idle]);

  return (
    <div style={{ padding: 24 }}>
      <h1>useIdle – 사용자 유휴 상태 감지</h1>
      <p>유휴 상태: <strong>{idle ? '예' : '아니오'}</strong></p>
      <p>마지막 활동: {new Date(lastActive).toLocaleTimeString()}</p>
      <p>활동 중일 때만 증가하는 타이머: {tick}s</p>

      {idle && (
        <div style={{
          marginTop: 12, padding: 12, background: '#fff7ed',
          border: '1px solid #fdba74', borderRadius: 8
        }}>
          유휴 상태입니다. 움직이거나 키를 누르면 해제됩니다.
        </div>
      )}

      <button onClick={reset} style={{ marginTop: 12 }}>
        수동으로 유휴 해제(리셋)
      </button>
    </div>
  );
}
```

---

### 구현 포인트

* `timeout` 지나면 `idle=true`로 전환, 활동 이벤트가 발생하면 즉시 `idle=false`로 해제
* `visibilitychange`를 포함해 탭 재진입도 활동으로 간주
* 유휴 시 API 폴링/애니메이션/인터벌을 멈추어 자원 절약
* 다중 탭 동기화가 필요하면 `localStorage` 이벤트(`storage`)를 추가해 확장 가능

---

다음은 **79번 `useOnlineEffect` – 온라인 복귀 시 동기화 트리거** 또는 **80번 `usePortal` – 포털 마운트 훅** 중 어느 것으로 이어갈까요?
