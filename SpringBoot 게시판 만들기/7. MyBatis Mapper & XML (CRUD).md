# 9) Mapper (인터페이스 + XML)

`src/main/java/com/example/boardapi/mapper/PostMapper.java`

```java
package com.example.boardapi.mapper;

import com.example.boardapi.domain.Post;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface PostMapper {
    int insert(Post post);
    int update(Post post);
    int deleteById(@Param("id") Long id);
    Post findById(@Param("id") Long id);

    List<Post> findAll(
            @Param("offset") int offset,
            @Param("limit") int limit,
            @Param("keyword") String keyword
    );

    long countAll(@Param("keyword") String keyword);

    int increaseViews(@Param("id") Long id);
}
```

`src/main/resources/mapper/PostMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.boardapi.mapper.PostMapper">

  <resultMap id="PostResult" type="com.example.boardapi.domain.Post">
    <id property="id" column="id"/>
    <result property="title" column="title"/>
    <result property="content" column="content"/>
    <result property="authorId" column="author_id"/>
    <result property="views" column="views"/>
    <result property="createdAt" column="created_at"/>
    <result property="updatedAt" column="updated_at"/>
  </resultMap>

  <sql id="columns">
    id, title, content, author_id, views, created_at, updated_at
  </sql>

  <insert id="insert" parameterType="com.example.boardapi.domain.Post" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO posts (title, content, author_id)
    VALUES (#{title}, #{content}, #{authorId})
  </insert>

  <update id="update" parameterType="com.example.boardapi.domain.Post">
    UPDATE posts
    SET
      title = #{title},
      content = #{content}
    WHERE id = #{id}
  </update>

  <delete id="deleteById" parameterType="long">
    DELETE FROM posts WHERE id = #{id}
  </delete>

  <select id="findById" resultMap="PostResult" parameterType="long">
    SELECT <include refid="columns"/>
    FROM posts
    WHERE id = #{id}
  </select>

  <update id="increaseViews" parameterType="long">
    UPDATE posts SET views = views + 1 WHERE id = #{id}
  </update>

  <select id="findAll" resultMap="PostResult">
    SELECT <include refid="columns"/>
    FROM posts
    <where>
      <if test="keyword != null and keyword != ''">
        (title LIKE CONCAT('%', #{keyword}, '%')
         OR content LIKE CONCAT('%', #{keyword}, '%'))
      </if>
    </where>
    ORDER BY id DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <select id="countAll" resultType="long">
    SELECT COUNT(*)
    FROM posts
    <where>
      <if test="keyword != null and keyword != ''">
        (title LIKE CONCAT('%', #{keyword}, '%')
         OR content LIKE CONCAT('%', #{keyword}, '%'))
      </if>
    </where>
  </select>

</mapper>
```

---