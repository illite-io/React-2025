# 8) 공통 응답/예외 처리

`src/main/java/com/example/boardapi/util/ApiResponse.java`

```java
package com.example.boardapi.util;

public record ApiResponse<T>(boolean success, T data, String message) {
    public static <T> ApiResponse<T> ok(T data) { return new ApiResponse<>(true, data, null); }
    public static <T> ApiResponse<T> ok(T data, String msg) { return new ApiResponse<>(true, data, msg); }
    public static <T> ApiResponse<T> fail(String msg) { return new ApiResponse<>(false, null, msg); }
}
```

`src/main/java/com/example/boardapi/exception/ErrorCode.java`

```java
package com.example.boardapi.exception;

public enum ErrorCode {
    NOT_FOUND("리소스를 찾을 수 없습니다."),
    BAD_REQUEST("요청 값이 잘못되었습니다."),
    INTERNAL_ERROR("서버 오류가 발생했습니다.");

    private final String message;
    ErrorCode(String message){ this.message = message; }
    public String message(){ return message; }
}
```

`src/main/java/com/example/boardapi/exception/ApiException.java`

```java
package com.example.boardapi.exception;

public class ApiException extends RuntimeException {
    private final ErrorCode errorCode;

    public ApiException(ErrorCode errorCode) {
        super(errorCode.message());
        this.errorCode = errorCode;
    }

    public ErrorCode getErrorCode() { return errorCode; }
}
```

`src/main/java/com/example/boardapi/exception/GlobalExceptionHandler.java`

```java
package com.example.boardapi.exception;

import com.example.boardapi.util.ApiResponse;
import jakarta.validation.ConstraintViolationException;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(ApiException.class)
    public ApiResponse<?> handleApi(ApiException e) {
        return ApiResponse.fail(e.getErrorCode().message());
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ApiResponse<?> handleValidation(MethodArgumentNotValidException e) {
        String msg = e.getBindingResult().getAllErrors().get(0).getDefaultMessage();
        return ApiResponse.fail(msg);
    }

    @ExceptionHandler(ConstraintViolationException.class)
    public ApiResponse<?> handleConstraint(ConstraintViolationException e) {
        return ApiResponse.fail(e.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public ApiResponse<?> handleGeneric(Exception e) {
        // 실제 운영에서는 로깅 추가
        return ApiResponse.fail(ErrorCode.INTERNAL_ERROR.message());
    }
}
```

---