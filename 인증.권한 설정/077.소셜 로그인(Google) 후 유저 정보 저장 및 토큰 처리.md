# âœ… 077. ì†Œì…œ ë¡œê·¸ì¸(Google) í›„ ìœ ì € ì •ë³´ ì €ì¥ ë° í† í° ì²˜ë¦¬

### ğŸ“„ ì„¤ëª…

Google ì†Œì…œ ë¡œê·¸ì¸ ì´í›„,
**ìœ ì € ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³ **,
**ì„œë²„ì—ì„œ ìì²´ JWT í† í°ì„ ë°œê¸‰í•˜ì—¬ í”„ë¡ íŠ¸ì— ì „ë‹¬**í•˜ëŠ” ê³¼ì •ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

---

## âœ… ì£¼ìš” í¬ì¸íŠ¸

* í”„ë¡ íŠ¸ì—ì„œ Google ì¸ì¦ í† í° ì „ë‹¬
* ë°±ì—”ë“œì—ì„œ Google í† í° ê²€ì¦ â†’ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
* ê¸°ì¡´ íšŒì› ì—¬ë¶€ í™•ì¸ í›„ DBì— ì €ì¥ or ë¡œê·¸ì¸ ì²˜ë¦¬
* ìì²´ JWT ë°œê¸‰í•˜ì—¬ ì‘ë‹µ

---

### ğŸ“ ì˜ˆì‹œ ë°±ì—”ë“œ íë¦„ (Node.js ê¸°ì¤€)

```js
// ì„œë²„: routes/auth.js

const { OAuth2Client } = require('google-auth-library');
const jwt = require('jsonwebtoken');
const User = require('../models/User');

const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);

app.post('/api/auth/google', async (req, res) => {
  const { credential } = req.body;

  const ticket = await client.verifyIdToken({
    idToken: credential,
    audience: process.env.GOOGLE_CLIENT_ID,
  });

  const payload = ticket.getPayload(); // { sub, email, name, picture }

  // DBì— ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
  let user = await User.findOne({ email: payload.email });

  if (!user) {
    // ì‹ ê·œ íšŒì›ì´ë©´ ì €ì¥
    user = await User.create({
      email: payload.email,
      name: payload.name,
      picture: payload.picture,
      provider: 'google',
    });
  }

  // ìì²´ í† í° ë°œê¸‰
  const token = jwt.sign({ userId: user._id }, process.env.JWT_SECRET, {
    expiresIn: '7d',
  });

  res.json({ token, user });
});
```

---

### ğŸ“ ì¶”ê°€ ì„¤ëª…

* `verifyIdToken()`ìœ¼ë¡œ Googleì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸
* `payload.sub`ëŠ” Google ì‚¬ìš©ì ê³ ìœ  ID
* ê¸°ì¡´ ì‚¬ìš©ìì™€ ì´ë©”ì¼ë¡œ ë§¤ì¹­í•˜ê±°ë‚˜, ê³ ìœ  subë¡œ ë§¤ì¹­ ê°€ëŠ¥
* í”„ë¡ íŠ¸ì—ì„œëŠ” ë°›ì€ `token`ì„ localStorage ë“±ì— ì €ì¥í•˜ê³  ë¡œê·¸ì¸ ì²˜ë¦¬

---
