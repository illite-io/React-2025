# 013. ë¡œê·¸ì¸ ìœ ì§€ ê¸°ëŠ¥ êµ¬í˜„ (í† í° ë§Œë£Œ ì „ ìë™ ê°±ì‹ )

JWT í† í°ì€ ë§Œë£Œ ì‹œê°„ì´ ì„¤ì •ë˜ì–´ ìˆì–´ ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ì¸ì¦ì´ í’€ë¦½ë‹ˆë‹¤.  
ì´ë¥¼ ë°©ì§€í•˜ë ¤ë©´ **Access Tokenê³¼ Refresh Token**ì„ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬, Access Tokenì´ ë§Œë£Œë˜ê¸° ì „ì— ìë™ìœ¼ë¡œ ê°±ì‹ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

---

## âœ… ì£¼ìš” í¬ì¸íŠ¸
- Access Tokenì€ ì§§ê²Œ, Refresh Tokenì€ ê¸¸ê²Œ ìœ ì§€
- Access Token ë§Œë£Œ ì „ ê°±ì‹  ìš”ì²­(`/refresh`) ì „ì†¡
- í† í°ì„ ìë™ ê°±ì‹ í•  íƒ€ì´ë¨¸(`setTimeout`) ë˜ëŠ” ì¸í„°ì…‰í„° í™œìš©

---

## âœ… ì˜ˆì‹œ ì½”ë“œ

### 1. ë¡œê·¸ì¸ ì‹œ í† í° ì €ì¥

```js
localStorage.setItem('accessToken', accessToken);
localStorage.setItem('refreshToken', refreshToken);
localStorage.setItem('accessTokenExpiresAt', Date.now() + 1000 * 60 * 10); // ì˜ˆ: 10ë¶„
```

---

### 2. ìë™ ê°±ì‹  íƒ€ì´ë¨¸ ì„¤ì • (src/hooks/useAutoRefreshToken.js)

```jsx
import { useEffect } from 'react';
import axios from 'axios';

const useAutoRefreshToken = () => {
  useEffect(() => {
    const refresh = async () => {
      try {
        const res = await axios.post('/auth/refresh', {
          refreshToken: localStorage.getItem('refreshToken'),
        });
        localStorage.setItem('accessToken', res.data.accessToken);
        localStorage.setItem(
          'accessTokenExpiresAt',
          Date.now() + 1000 * 60 * 10
        );
        console.log('í† í° ìë™ ê°±ì‹  ì„±ê³µ');
      } catch (err) {
        console.error('í† í° ê°±ì‹  ì‹¤íŒ¨');
        localStorage.clear();
        window.location.href = '/login';
      }
    };

    const expiresAt = parseInt(localStorage.getItem('accessTokenExpiresAt'), 10);
    const timeLeft = expiresAt - Date.now();

    if (timeLeft > 0) {
      const timer = setTimeout(refresh, timeLeft - 5000); // ë§Œë£Œ 5ì´ˆ ì „ ê°±ì‹ 
      return () => clearTimeout(timer);
    }
  }, []);
};

export default useAutoRefreshToken;
```

---

### 3. ì•± ì§„ì… ì‹œ ì ìš© (src/App.js)

```jsx
import useAutoRefreshToken from './hooks/useAutoRefreshToken';

function App() {
  useAutoRefreshToken();

  return (
    <div>
      <h2>ì•± ë©”ì¸</h2>
    </div>
  );
}
```

---

## ğŸ“ ì¶”ê°€ ì„¤ëª…
- ë°±ì—”ë“œê°€ `/auth/refresh` ìš”ì²­ì„ ìˆ˜ë½í•˜ê³  ìƒˆë¡œìš´ í† í°ì„ ë°œê¸‰í•´ì£¼ëŠ” êµ¬ì¡°ì—¬ì•¼ í•¨
- í† í°ì´ ë§Œë£Œë˜ê¸° ì „ ë¯¸ë¦¬ ê°±ì‹ í•˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš© ì¤‘ ì¸ì¦ì´ ëŠê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒ
- React Query ë˜ëŠ” Axios ì¸í„°ì…‰í„°ë¡œ ê°±ì‹  ì²˜ë¦¬ë„ ê°€ëŠ¥
