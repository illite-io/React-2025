좋습니다. 이번에는 **82번 – usePermission 권한 관리** 예제를 보겠습니다.

---

## 82. usePermission 권한 관리

### 목표

* 현재 로그인된 사용자의 **역할(Role) / 권한(Permission)** 기반 접근 제어
* 특정 기능/컴포넌트 렌더링 여부를 제어
* `useAuth`(81번) 훅과 연동 가능

---

### 파일 경로 / 파일명

```
src/hooks/usePermission.js
src/App.js
```

---

### 1) 커스텀 훅 – `usePermission.js`

```javascript
import { useMemo } from "react";
import useAuth from "./useAuth";

/**
 * usePermission(requiredRoles?, requiredPerms?)
 * - requiredRoles: ["admin", "manager"] 등 허용 역할
 * - requiredPerms: ["user.read", "user.write"] 등 허용 권한
 *
 * 반환: { canAccess, hasRole, hasPerm }
 */
export default function usePermission(requiredRoles = [], requiredPerms = []) {
  const { user } = useAuth();

  const roles = user?.roles || [];       // 예: ["user", "admin"]
  const perms = user?.permissions || []; // 예: ["user.read", "order.create"]

  const hasRole = (r) => roles.includes(r);
  const hasPerm = (p) => perms.includes(p);

  const canAccess = useMemo(() => {
    const roleOk = requiredRoles.length === 0 || requiredRoles.some((r) => hasRole(r));
    const permOk = requiredPerms.length === 0 || requiredPerms.every((p) => hasPerm(p));
    return roleOk && permOk;
  }, [requiredRoles, requiredPerms, roles, perms]);

  return { canAccess, hasRole, hasPerm };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React from "react";
import AppAuthProvider from "./AuthProvider";
import useAuth from "./hooks/useAuth";
import usePermission from "./hooks/usePermission";

function Dashboard() {
  const { user } = useAuth();

  // 관리자만 접근 가능
  const { canAccess: isAdmin } = usePermission(["admin"]);
  // 글쓰기 권한 필요
  const { canAccess: canWrite } = usePermission([], ["post.write"]);

  return (
    <div style={{ border: "1px solid #e5e7eb", borderRadius: 8, padding: 16, marginTop: 20 }}>
      <h2>대시보드</h2>
      <p>현재 사용자: {user?.name}</p>

      {isAdmin && <p style={{ color: "green" }}>관리자 전용 메시지: 시스템 설정 가능</p>}
      {!isAdmin && <p style={{ color: "gray" }}>관리자 권한 없음</p>}

      <div style={{ marginTop: 12 }}>
        {canWrite ? (
          <button>새 글 작성</button>
        ) : (
          <button disabled>글쓰기 권한 없음</button>
        )}
      </div>
    </div>
  );
}

function DemoLoginButtons() {
  const { login, logout, isAuthenticated, setUser } = useAuth();

  const loginAsUser = async () => {
    await login({ username: "홍길동" });
    setUser({
      name: "홍길동",
      roles: ["user"],
      permissions: ["post.read"],
    });
  };

  const loginAsAdmin = async () => {
    await login({ username: "관리자" });
    setUser({
      name: "관리자",
      roles: ["admin"],
      permissions: ["post.read", "post.write"],
    });
  };

  return (
    <div style={{ display: "flex", gap: 8, marginBottom: 16 }}>
      {!isAuthenticated ? (
        <>
          <button onClick={loginAsUser}>일반 사용자 로그인</button>
          <button onClick={loginAsAdmin}>관리자 로그인</button>
        </>
      ) : (
        <button onClick={logout}>로그아웃</button>
      )}
    </div>
  );
}

export default function App() {
  return (
    <AppAuthProvider>
      <div style={{ padding: 20 }}>
        <h1>usePermission 권한 관리</h1>
        <DemoLoginButtons />
        <Dashboard />
      </div>
    </AppAuthProvider>
  );
}
```

---

### 동작 방식

1. `usePermission(requiredRoles, requiredPerms)` 호출
2. 현재 사용자(`user.roles`, `user.permissions`)와 비교
3. 접근 가능 여부 `canAccess` 반환 → UI 제어

---

### 활용 아이디어

* 메뉴/버튼 표시 조건 (`관리자만 보기`, `편집 가능 여부`)
* 라우터 가드(권한 없으면 리다이렉트)
* 백엔드와 통일된 권한 스키마 관리

---

다음은 **83번 – useCart 장바구니 관리** 예제로 넘어가시겠습니까?
