좋습니다. 이제 **83번 – useCart 장바구니 관리** 예제를 보겠습니다.

---

## 83. useCart 장바구니 관리

### 목표

* 장바구니 항목 추가/수정/삭제
* 수량 변경, 중복 항목 병합
* 합계 금액, 총 수량 파생값 제공
* 영속성(localStorage) 옵션

---

### 파일 경로 / 파일명

```
src/hooks/useCart.js
src/App.js
```

---

### 1) 커스텀 훅 – `useCart.js`

```javascript
import { useCallback, useEffect, useMemo, useState } from "react";

/**
 * useCart({ storageKey }?)
 * item 형태 예시: { id: 'sku_1', name: '상품', price: 12000, qty: 1, image?: '...' }
 */
export default function useCart({ storageKey = "cart.items" } = {}) {
  const [items, setItems] = useState(() => {
    try {
      const raw = localStorage.getItem(storageKey);
      return raw ? JSON.parse(raw) : [];
    } catch {
      return [];
    }
  });

  // 영속화
  useEffect(() => {
    try {
      localStorage.setItem(storageKey, JSON.stringify(items));
    } catch {}
  }, [items, storageKey]);

  const add = useCallback((newItem) => {
    setItems((prev) => {
      const i = prev.findIndex((p) => p.id === newItem.id);
      if (i === -1) return [...prev, { ...newItem, qty: newItem.qty ?? 1 }];
      const merged = [...prev];
      merged[i] = { ...merged[i], qty: (merged[i].qty ?? 1) + (newItem.qty ?? 1) };
      return merged;
    });
  }, []);

  const setQty = useCallback((id, qty) => {
    setItems((prev) =>
      prev
        .map((p) => (p.id === id ? { ...p, qty } : p))
        .filter((p) => (p.qty ?? 0) > 0)
    );
  }, []);

  const remove = useCallback((id) => {
    setItems((prev) => prev.filter((p) => p.id !== id));
  }, []);

  const clear = useCallback(() => setItems([]), []);

  const increment = useCallback((id, step = 1) => {
    setItems((prev) =>
      prev.map((p) => (p.id === id ? { ...p, qty: (p.qty ?? 0) + step } : p))
    );
  }, []);

  const decrement = useCallback((id, step = 1) => {
    setItems((prev) =>
      prev
        .map((p) => (p.id === id ? { ...p, qty: (p.qty ?? 0) - step } : p))
        .filter((p) => (p.qty ?? 0) > 0)
    );
  }, []);

  const count = useMemo(() => items.reduce((n, it) => n + (it.qty ?? 0), 0), [items]);
  const subtotal = useMemo(() => items.reduce((sum, it) => sum + (it.price ?? 0) * (it.qty ?? 0), 0), [items]);

  // 배송비/할인 계산 예시 (필요 시 외부에서 주입)
  const shipping = useMemo(() => (subtotal > 50000 || subtotal === 0 ? 0 : 3000), [subtotal]);
  const discount = 0;
  const total = subtotal + shipping - discount;

  const has = useCallback((id) => items.some((p) => p.id === id), [items]);
  const get = useCallback((id) => items.find((p) => p.id === id), [items]);

  return {
    items, add, setQty, increment, decrement, remove, clear, has, get,
    count, subtotal, shipping, discount, total,
  };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React from "react";
import useCart from "./hooks/useCart";

const CATALOG = [
  { id: "sku_1", name: "블루 티셔츠", price: 19000 },
  { id: "sku_2", name: "블랙 팬츠", price: 39000 },
  { id: "sku_3", name: "화이트 스니커즈", price: 69000 },
];

export default function App() {
  const {
    items, add, setQty, increment, decrement, remove, clear,
    count, subtotal, shipping, total,
  } = useCart();

  return (
    <div style={{ padding: 20, maxWidth: 760, margin: "0 auto" }}>
      <h1>useCart 장바구니 관리</h1>

      <h2>상품 목록</h2>
      <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(220px,1fr))", gap: 12 }}>
        {CATALOG.map((p) => (
          <div key={p.id} style={{ border: "1px solid #e5e7eb", borderRadius: 8, padding: 12 }}>
            <strong>{p.name}</strong>
            <div style={{ color: "#475569" }}>{p.price.toLocaleString()}원</div>
            <button onClick={() => add({ ...p, qty: 1 })} style={{ marginTop: 8 }}>
              담기
            </button>
          </div>
        ))}
      </div>

      <h2 style={{ marginTop: 24 }}>장바구니 ({count})</h2>
      {items.length === 0 ? (
        <p>장바구니가 비었습니다.</p>
      ) : (
        <table style={{ width: "100%", borderCollapse: "collapse" }}>
          <thead>
            <tr style={{ textAlign: "left", borderBottom: "1px solid #e2e8f0" }}>
              <th>상품</th><th>가격</th><th>수량</th><th>금액</th><th></th>
            </tr>
          </thead>
          <tbody>
            {items.map((it) => (
              <tr key={it.id} style={{ borderBottom: "1px solid #f1f5f9" }}>
                <td>{it.name}</td>
                <td>{it.price.toLocaleString()}원</td>
                <td>
                  <div style={{ display: "inline-flex", gap: 6, alignItems: "center" }}>
                    <button onClick={() => decrement(it.id)}>-</button>
                    <input
                      value={it.qty}
                      onChange={(e) => setQty(it.id, Math.max(0, Number(e.target.value || 0)))}
                      style={{ width: 48, textAlign: "center" }}
                    />
                    <button onClick={() => increment(it.id)}>+</button>
                  </div>
                </td>
                <td>{(it.price * it.qty).toLocaleString()}원</td>
                <td><button onClick={() => remove(it.id)}>삭제</button></td>
              </tr>
            ))}
          </tbody>
        </table>
      )}

      <div style={{ marginTop: 16, textAlign: "right" }}>
        <p>소계: {subtotal.toLocaleString()}원</p>
        <p>배송비: {shipping.toLocaleString()}원</p>
        <p><strong>총합: {total.toLocaleString()}원</strong></p>
        <div style={{ marginTop: 8, display: "flex", gap: 8, justifyContent: "flex-end" }}>
          <button onClick={clear}>비우기</button>
          <button disabled={items.length === 0}>주문하기</button>
        </div>
      </div>
    </div>
  );
}
```

---

### 포인트

* 동일 `id`로 `add()`하면 수량을 병합해 UX 단순화.
* 수량이 0 이하가 되면 자동 제거해 장바구니 정합성 유지.
* 파생값(`count`, `subtotal`, `total`)은 `useMemo` 기반으로 성능 안정.
* 배송비/할인은 프로젝트 규칙에 맞게 계산 함수를 바꿔 주입하면 유연해집니다.

---

다음은 **84번 – useWishlist 위시리스트 관리**로 넘어가겠습니다. 계속 진행할까요?
