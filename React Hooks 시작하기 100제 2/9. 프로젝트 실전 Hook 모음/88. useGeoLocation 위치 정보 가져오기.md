좋습니다. 이번에는 **88번 – useGeoLocation 위치 정보 가져오기** 예제를 보겠습니다.

---

## 88. useGeoLocation 위치 정보 가져오기

### 목표

* 브라우저의 **Geolocation API**를 이용해 현재 위치(위도, 경도 등) 가져오기
* `watchPosition`으로 실시간 추적 가능
* 권한 거부/에러 처리 지원

---

### 파일 경로 / 파일명

```
src/hooks/useGeoLocation.js
src/App.js
```

---

### 1) 커스텀 훅 – `useGeoLocation.js`

```javascript
import { useEffect, useState } from "react";

/**
 * useGeoLocation({ enableHighAccuracy, maximumAge, timeout, watch })
 * - enableHighAccuracy: GPS 등 고정밀 모드 여부 (배터리 소모 ↑)
 * - maximumAge: 캐시 허용(ms)
 * - timeout: 응답 제한(ms)
 * - watch: true면 watchPosition, false면 getCurrentPosition
 *
 * 반환:
 * { location, error, loading }
 * location = { lat, lng, accuracy, timestamp }
 */
export default function useGeoLocation(options = {}) {
  const {
    enableHighAccuracy = true,
    maximumAge = 0,
    timeout = 5000,
    watch = false,
  } = options;

  const [location, setLocation] = useState(null);
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!("geolocation" in navigator)) {
      setError("이 브라우저는 위치 정보를 지원하지 않습니다.");
      setLoading(false);
      return;
    }

    const opts = { enableHighAccuracy, maximumAge, timeout };

    const onSuccess = (pos) => {
      setLocation({
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
        accuracy: pos.coords.accuracy,
        timestamp: pos.timestamp,
      });
      setError(null);
      setLoading(false);
    };

    const onError = (err) => {
      setError(err.message);
      setLoading(false);
    };

    let watcherId;
    if (watch) {
      watcherId = navigator.geolocation.watchPosition(onSuccess, onError, opts);
    } else {
      navigator.geolocation.getCurrentPosition(onSuccess, onError, opts);
    }

    return () => {
      if (watcherId) navigator.geolocation.clearWatch(watcherId);
    };
  }, [enableHighAccuracy, maximumAge, timeout, watch]);

  return { location, error, loading };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React from "react";
import useGeoLocation from "./hooks/useGeoLocation";

export default function App() {
  const { location, error, loading } = useGeoLocation({ watch: true });

  return (
    <div style={{ padding: 20 }}>
      <h1>useGeoLocation 위치 정보 가져오기</h1>

      {loading && <p>위치 정보를 불러오는 중...</p>}
      {error && <p style={{ color: "red" }}>에러: {error}</p>}
      {location && (
        <div>
          <p><strong>위도:</strong> {location.lat}</p>
          <p><strong>경도:</strong> {location.lng}</p>
          <p><strong>정확도:</strong> ±{location.accuracy}m</p>
          <p><strong>시간:</strong> {new Date(location.timestamp).toLocaleString()}</p>
        </div>
      )}
    </div>
  );
}
```

---

### 동작 방식

1. `navigator.geolocation.getCurrentPosition()` → 한 번만 가져오기
2. `navigator.geolocation.watchPosition()` → 지속적으로 추적
3. `location` 상태에 `{ lat, lng, accuracy, timestamp }` 저장
4. 권한 거부 시 `error` 상태에 메시지 반환

---

### 활용 아이디어

* 지도 앱에서 현재 위치 마커 표시
* 배달/이동 서비스의 위치 추적
* 출퇴근/운동 기록용 앱 GPS 기록

---

다음은 **89번 – usePayment 결제 처리 상태** 예제로 넘어가시겠습니까?
