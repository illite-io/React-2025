좋습니다. **71번 – useDarkMode 다크 모드 토글**로 진행하겠습니다.

---

## 71. useDarkMode 다크 모드 토글

### 목표

* 시스템 설정(`prefers-color-scheme`)을 기본값으로 사용
* 사용자가 토글하면 로컬에 저장(localStorage)
* `<html>`에 `class="dark"`를 붙여 전역 스타일 제어(Tailwind 등과 궁합)

---

### 파일 경로 / 파일명

```
src/hooks/useDarkMode.js
src/App.js
```

---

### 1) 커스텀 훅 – `useDarkMode.js`

```javascript
import { useCallback, useEffect, useMemo, useState } from "react";

/**
 * useDarkMode()
 * 반환: { isDark, toggle, setDark, setLight, system }
 * - isDark: 현재 다크 모드 여부
 * - toggle(): 다크/라이트 전환
 * - setDark(), setLight(): 명시적 설정
 * - system: 시스템 선호값('dark' | 'light')
 */
export default function useDarkMode() {
  // SSR/비브라우저 환경 안전 가드
  const hasWindow = typeof window !== "undefined" && typeof document !== "undefined";

  // 시스템 기본값 감지
  const systemPrefersDark = useMemo(() => {
    if (!hasWindow) return false;
    return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  }, [hasWindow]);

  const [isDark, setIsDark] = useState(() => {
    if (!hasWindow) return false;
    const saved = window.localStorage.getItem("theme");
    if (saved === "dark") return true;
    if (saved === "light") return false;
    return systemPrefersDark;
  });

  // html.class 동기화
  useEffect(() => {
    if (!hasWindow) return;
    const root = document.documentElement;
    root.classList.toggle("dark", isDark);
    // 저장: 사용자가 시스템 기본과 다른 선택을 했을 때만 저장해도 되지만 단순화를 위해 항상 저장
    window.localStorage.setItem("theme", isDark ? "dark" : "light");
  }, [isDark, hasWindow]);

  // 시스템 변경 실시간 반영(사용자가 수동으로 바꾼 적 없을 때에만 반영하고 싶다면 추가 상태로 제어)
  useEffect(() => {
    if (!hasWindow || !window.matchMedia) return;
    const mql = window.matchMedia("(prefers-color-scheme: dark)");
    const listener = (e) => {
      const saved = window.localStorage.getItem("theme");
      // 저장된 값이 없으면 시스템 변경을 따라감
      if (saved !== "dark" && saved !== "light") {
        setIsDark(e.matches);
      }
    };
    mql.addEventListener?.("change", listener);
    return () => mql.removeEventListener?.("change", listener);
  }, [hasWindow]);

  const toggle = useCallback(() => setIsDark((v) => !v), []);
  const setDark = useCallback(() => setIsDark(true), []);
  const setLight = useCallback(() => setIsDark(false), []);

  return {
    isDark,
    toggle,
    setDark,
    setLight,
    system: systemPrefersDark ? "dark" : "light",
  };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React from "react";
import useDarkMode from "./hooks/useDarkMode";

export default function App() {
  const { isDark, toggle, setDark, setLight, system } = useDarkMode();

  const box = {
    padding: 16,
    borderRadius: 10,
    border: `1px solid ${isDark ? "#374151" : "#e5e7eb"}`,
    background: isDark ? "#111827" : "#ffffff",
    color: isDark ? "#e5e7eb" : "#111827",
  };

  const subtle = { color: isDark ? "#9ca3af" : "#4b5563" };

  return (
    <div style={{ padding: 20, background: isDark ? "#0b1020" : "#f7f7f9", minHeight: "100vh" }}>
      <h1 style={{ color: isDark ? "#e5e7eb" : "#111827" }}>useDarkMode 다크 모드 토글</h1>

      <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
        <button onClick={toggle}>{isDark ? "라이트로" : "다크로"} 전환</button>
        <button onClick={setDark}>다크</button>
        <button onClick={setLight}>라이트</button>
      </div>

      <p style={subtle}>
        시스템 선호: <strong>{system}</strong> / 현재: <strong>{isDark ? "dark" : "light"}</strong>
      </p>

      <div style={box}>
        <p>이 박스는 현재 테마에 따라 배경/텍스트/테두리 색이 바뀝니다.</p>
        <p style={subtle}>Tailwind를 쓴다면 html에 `.dark` 클래스가 붙습니다.</p>
      </div>
    </div>
  );
}
```

---

### 실무 팁

* Tailwind 사용 시 `tailwind.config.js`에 `darkMode: 'class'` 설정.
* 다크 모드 깜빡임 방지: 초기 HTML에 인라인 스크립트로 localStorage 값을 읽어 `document.documentElement.classList.add('dark')` 적용 후 React 마운트.
* 팀 규칙에 따라 “시스템 따르기” 옵션을 별도 제공하려면 저장 로직을 `auto | dark | light` 3상태로 확장.

---

다음은 **72번 – useTheme 테마 변경**으로 이어가겠습니다. 계속 진행할까요?
