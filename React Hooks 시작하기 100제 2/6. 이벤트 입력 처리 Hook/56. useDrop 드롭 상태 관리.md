좋습니다. **56번 – useDrop 드롭 상태 관리**로 진행하겠습니다.

---

## 56. useDrop 드롭 상태 관리

### 목표

* 드래그 항목이 **드롭존 위에 들어옴/머묾/나감/떨어짐**을 감지
* `dragenter`, `dragover`, `dragleave`, `drop` 이벤트 처리
* 텍스트/URL/파일 드롭 모두 지원

---

### 파일 경로 / 파일명

```
src/hooks/useDrop.js
src/App.js
```

---

### 1) 커스텀 훅 – `useDrop.js`

```javascript
import { useCallback, useEffect, useRef, useState } from 'react';

/**
 * useDrop({ onDrop, onText, onUri, onFiles, disabled }?)
 * 반환: { ref, isOver }
 * - ref: 드롭존 요소에 연결
 * - isOver: 드롭 가능한 항목이 위에 있는지 여부
 */
export default function useDrop(opts = {}) {
  const { onDrop, onText, onUri, onFiles, disabled = false } = opts;
  const ref = useRef(null);
  const [isOver, setIsOver] = useState(false);
  const dragDepth = useRef(0); // 중첩 enter/leave 보정

  const preventDefaults = useCallback((e) => {
    e.preventDefault();
    e.stopPropagation();
  }, []);

  useEffect(() => {
    const el = ref.current;
    if (!el || disabled) return;

    const onDragEnter = (e) => {
      preventDefaults(e);
      dragDepth.current += 1;
      setIsOver(true);
    };

    const onDragOver = (e) => {
      // drop 허용을 위해 기본 동작 막기
      preventDefaults(e);
      // 커서 모양 힌트
      e.dataTransfer.dropEffect = 'copy';
    };

    const onDragLeave = (e) => {
      preventDefaults(e);
      dragDepth.current -= 1;
      if (dragDepth.current <= 0) {
        setIsOver(false);
        dragDepth.current = 0;
      }
    };

    const onDropEvt = async (e) => {
      preventDefaults(e);
      dragDepth.current = 0;
      setIsOver(false);

      const dt = e.dataTransfer;
      // 1) 파일
      if (dt.files && dt.files.length) {
        onFiles?.(Array.from(dt.files), e);
        onDrop?.(e);
        return;
      }
      // 2) URL
      const uri = dt.getData('text/uri-list') || dt.getData('URL');
      if (uri) {
        onUri?.(uri, e);
        onDrop?.(e);
        return;
      }
      // 3) 일반 텍스트
      const text = dt.getData('text') || dt.getData('text/plain');
      if (text) {
        onText?.(text, e);
        onDrop?.(e);
        return;
      }
      onDrop?.(e);
    };

    el.addEventListener('dragenter', onDragEnter);
    el.addEventListener('dragover', onDragOver);
    el.addEventListener('dragleave', onDragLeave);
    el.addEventListener('drop', onDropEvt);

    return () => {
      el.removeEventListener('dragenter', onDragEnter);
      el.removeEventListener('dragover', onDragOver);
      el.removeEventListener('dragleave', onDragLeave);
      el.removeEventListener('drop', onDropEvt);
    };
  }, [disabled, onDrop, onFiles, onUri, onText, preventDefaults]);

  return { ref, isOver };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React, { useState } from 'react';
import useDrop from './hooks/useDrop';

export default function App() {
  const [log, setLog] = useState([]);
  const [files, setFiles] = useState([]);

  const { ref, isOver } = useDrop({
    onFiles: (fs) => {
      setFiles((prev) => [...prev, ...fs]);
      setLog((prev) => [`파일 ${fs.length}개 드롭`, ...prev]);
    },
    onUri: (uri) => setLog((prev) => [`URL 드롭: ${uri}`, ...prev]),
    onText: (text) => setLog((prev) => [`텍스트 드롭: ${text.slice(0, 40)}...`, ...prev]),
    onDrop: () => setLog((prev) => [`드롭 완료`, ...prev]),
  });

  return (
    <div style={{ maxWidth: 720, margin: '40px auto', padding: '0 16px' }}>
      <h1>useDrop 드롭 상태 관리</h1>

      <div
        ref={ref}
        style={{
          border: `2px dashed ${isOver ? '#2563eb' : '#cbd5e1'}`,
          background: isOver ? '#eff6ff' : '#f8fafc',
          color: '#334155',
          padding: 24,
          borderRadius: 10,
          textAlign: 'center',
          transition: 'all 120ms ease',
        }}
      >
        여기에 파일/텍스트/URL을 드래그해서 놓으세요
      </div>

      {files.length > 0 && (
        <div style={{ marginTop: 16 }}>
          <h3>파일 목록</h3>
          <ul>
            {files.map((f, i) => (
              <li key={i}>{f.name} ({Math.round(f.size / 1024)} KB)</li>
            ))}
          </ul>
        </div>
      )}

      <div style={{ marginTop: 16 }}>
        <h3>이벤트 로그</h3>
        <ul>
          {log.map((l, i) => <li key={i}>{l}</li>)}
        </ul>
      </div>
    </div>
  );
}
```

---

## 포인트와 주의사항

* **`dragover`에서 `preventDefault`** 해야 드롭이 허용됩니다.
* **중첩 enter/leave 보정**: 자식 노드로 마우스가 드는 순간 `dragleave`가 먼저 발생할 수 있어 `dragDepth`로 균형을 맞춥니다.
* **보안 제한**: 일부 브라우저/페이지에서는 클립보드/파일 접근이 제한될 수 있습니다.
* **접근성**: 키보드만으로도 업로드 가능하도록 파일 `<input type="file">` 대체 경로를 제공하세요.

---

### 확장 아이디어

* 이미지 파일만 허용: `Array.from(files).filter(f => f.type.startsWith('image/'))`
* 대용량 업로드 진행률 UI: 70번(useProgress)와 결합
* 폴더 드롭(Chrome): `webkitGetAsEntry()`를 사용해 재귀 탐색

---

다음은 **57번 – useTouch 터치 이벤트 감지**로 넘어가겠습니다. 계속 진행할까요?
