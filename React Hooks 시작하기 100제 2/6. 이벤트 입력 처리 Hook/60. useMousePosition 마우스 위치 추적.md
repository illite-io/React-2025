좋습니다. 이제 **60번 – useMousePosition 마우스 위치 추적** 예제를 보겠습니다.

---

## 60. useMousePosition 마우스 위치 추적

### 목표

* 현재 마우스 좌표를 상태로 제공 `{ x, y }`
* 성능을 위해 `requestAnimationFrame`으로 샘플링(과도한 렌더 방지)
* 특정 컨테이너 내 상대 좌표도 선택적으로 지원

---

### 파일 경로 / 파일명

```
src/hooks/useMousePosition.js
src/App.js
```

---

### 1) 커스텀 훅 – `useMousePosition.js`

```javascript
import { useEffect, useRef, useState } from "react";

/**
 * useMousePosition(target?)
 * - target: 좌표 기준 요소(선택). 주면 해당 요소 내부의 상대 좌표를 반환.
 * - 반환: { x, y, pageX, pageY }
 */
export default function useMousePosition(target) {
  const [pos, setPos] = useState({ x: 0, y: 0, pageX: 0, pageY: 0 });
  const ticking = useRef(false);

  useEffect(() => {
    const el = target || window;

    const handler = (e) => {
      if (ticking.current) return;
      ticking.current = true;

      requestAnimationFrame(() => {
        ticking.current = false;

        const pageX = e.pageX;
        const pageY = e.pageY;

        if (target && target instanceof HTMLElement) {
          const rect = target.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          setPos({ x, y, pageX, pageY });
        } else {
          // 윈도우 기준은 client 좌표를 그대로 반환
          setPos({ x: e.clientX, y: e.clientY, pageX, pageY });
        }
      });
    };

    // window와 element 모두 mousemove를 들을 수 있음
    const listenTarget = target || window;
    listenTarget.addEventListener("mousemove", handler, { passive: true });

    return () => {
      listenTarget.removeEventListener("mousemove", handler);
    };
  }, [target]);

  return pos;
}
```

---

### 2) 기본 사용 – 화면 전체 좌표 (`App.js`)

```javascript
import React from "react";
import useMousePosition from "./hooks/useMousePosition";

export default function App() {
  const { x, y } = useMousePosition(); // window 기준

  return (
    <div style={{ padding: 20, height: "100vh" }}>
      <h1>useMousePosition 마우스 위치 추적</h1>
      <p>윈도우 기준 좌표: x={x}, y={y}</p>
    </div>
  );
}
```

---

### 3) 특정 컨테이너 내 상대 좌표

```javascript
import React, { useRef, useEffect, useState } from "react";
import useMousePosition from "./hooks/useMousePosition";

export default function BoxDemo() {
  const boxRef = useRef(null);
  const [el, setEl] = useState(null);

  useEffect(() => setEl(boxRef.current), []);

  const { x, y } = useMousePosition(el); // 컨테이너 내부 좌표

  return (
    <div style={{ padding: 20 }}>
      <h2>컨테이너 상대 좌표</h2>
      <div
        ref={boxRef}
        style={{
          width: 400,
          height: 240,
          border: "1px solid #ddd",
          borderRadius: 8,
          position: "relative",
          background: "#fafafa",
        }}
      >
        <div
          style={{
            position: "absolute",
            left: Math.max(0, Math.min(400 - 10, x - 5)),
            top: Math.max(0, Math.min(240 - 10, y - 5)),
            width: 10,
            height: 10,
            borderRadius: "50%",
            background: "#2563eb",
            pointerEvents: "none",
          }}
        />
      </div>
      <p>박스 기준 좌표: x={Math.round(x)}, y={Math.round(y)}</p>
    </div>
  );
}
```

---

## 동작 설명

* 윈도우 기준: `clientX/Y`를 그대로 `{ x, y }`로 제공.
* 특정 요소 기준: 요소의 `getBoundingClientRect()`를 사용해 상대 좌표 계산.
* `requestAnimationFrame`으로 샘플링해 마우스 이동 이벤트 폭주 시 렌더 횟수를 줄임.

---

## 실무 팁

* 좌표를 토대로 도구 툴팁, 커서 추적 애니메이션, 드로잉 보드 등 구현 가능.
* 초고빈도 렌더가 필요하면 상태 대신 `ref`로만 저장하고, 일정 주기로만 상태 동기화.
* 터치까지 지원하려면 57번의 `useTouch`와 결합하거나 `pointermove` 이벤트로 통합 관리.

---

다음은 **61번 – useFetchJSON JSON 데이터 요청**으로 넘어갈까요?
