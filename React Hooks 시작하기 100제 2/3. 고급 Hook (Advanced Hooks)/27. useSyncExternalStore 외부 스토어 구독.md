좋습니다. 이제 **27번 – useSyncExternalStore 외부 스토어 구독** 예제를 보겠습니다.

---

## 27. useSyncExternalStore 외부 스토어 구독

### 핵심 개념

* React 18에서 추가된 Hook
* **외부 스토어(state container)** 를 React와 동기화하는 표준 API
* 예전에는 `useEffect` + 이벤트 리스너 조합으로 직접 구독했지만,
  `useSyncExternalStore`는 **SSR 지원 + 안정적인 동기화**를 제공합니다.
* Redux, Zustand 같은 상태관리 라이브러리 내부에서도 이 API를 사용합니다.

---

### 파일 경로 / 파일명

```
src/store/counterStore.js
```

### 간단한 카운터 스토어 구현

```javascript
let count = 0;
const listeners = new Set();

export const counterStore = {
  // 상태 읽기
  getSnapshot: () => count,

  // 상태 업데이트
  increment: () => {
    count++;
    listeners.forEach((listener) => listener());
  },
  decrement: () => {
    count--;
    listeners.forEach((listener) => listener());
  },

  // 구독 관리
  subscribe: (listener) => {
    listeners.add(listener);
    return () => listeners.delete(listener); // 구독 해제
  },
};
```

---

### 파일 경로 / 파일명

```
src/App.js
```

### React 컴포넌트에서 구독하기

```javascript
import React, { useSyncExternalStore } from 'react';
import { counterStore } from './store/counterStore';

export default function App() {
  // 외부 스토어와 동기화
  const count = useSyncExternalStore(
    counterStore.subscribe,   // 구독 함수
    counterStore.getSnapshot  // 현재 상태 가져오기
  );

  return (
    <div style={{ padding: 20 }}>
      <h1>useSyncExternalStore 예제</h1>
      <p>현재 카운트: {count}</p>
      <button onClick={counterStore.increment}>+1</button>
      <button onClick={counterStore.decrement}>-1</button>
    </div>
  );
}
```

---

### 코드 설명

1. **스토어 구조**

   * `count`는 React state가 아님 (외부 변수)
   * `listeners`에 컴포넌트 구독자 등록
   * 상태가 바뀌면 `listeners` 전부 호출 → 리렌더링 유도

2. **useSyncExternalStore**

   ```javascript
   const value = useSyncExternalStore(subscribe, getSnapshot);
   ```

   * `subscribe(listener)` : 상태가 바뀌면 listener 실행 → React가 자동 리렌더링
   * `getSnapshot()` : 현재 상태 반환 (렌더링 시 동기적으로 값 제공)

3. **장점**

   * SSR 환경에서 초기 스냅샷 동기화 가능
   * 외부 스토어를 React state처럼 안전하게 사용 가능
   * Redux, Zustand 등 라이브러리 구현의 기반

---

### 실행 흐름

1. `App` 렌더링 → `useSyncExternalStore`로 count 값 읽음 (초기값 0)
2. 버튼 클릭 → `counterStore.increment()` 실행 → count 증가 후 모든 구독자 listener 호출
3. `useSyncExternalStore`가 listener를 통해 상태 변경 감지 → 컴포넌트 리렌더링

---

👉 여기까지 하면, React state가 아닌 외부 스토어 값도 안정적으로 React 렌더링 사이클에 맞춰 사용할 수 있습니다.

---

다음은 **28번 – useInsertionEffect 스타일 삽입 타이밍 제어** 예제로 넘어가겠습니다. 계속 진행할까요?
