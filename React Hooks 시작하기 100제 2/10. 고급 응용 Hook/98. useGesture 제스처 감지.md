좋습니다. 이번에는 **98번 – useGesture 제스처 감지** 예제를 보겠습니다.

---

## 98. useGesture 제스처 감지

### 목표

* 터치/마우스 기반 제스처(드래그, 스와이프, 핀치 등) 감지
* 시작/이동/종료 이벤트를 상태로 관리
* 단일 훅으로 마우스·터치 이벤트 모두 처리

---

### 파일 경로 / 파일명

```
src/hooks/useGesture.js
src/App.js
```

---

### 1) 커스텀 훅 – `useGesture.js`

```javascript
import { useCallback, useRef, useState } from "react";

/**
 * useGesture()
 * 반환:
 * {
 *   ref,            // 대상 요소에 ref 연결
 *   state: { dragging, start, current, delta, lastEvent },
 *   reset,
 * }
 */
export default function useGesture() {
  const ref = useRef(null);
  const [state, setState] = useState({
    dragging: false,
    start: null,      // {x, y}
    current: null,    // {x, y}
    delta: { x: 0, y: 0 },
    lastEvent: null,
  });

  const onStart = useCallback((x, y, evt) => {
    setState({
      dragging: true,
      start: { x, y },
      current: { x, y },
      delta: { x: 0, y: 0 },
      lastEvent: evt.type,
    });
  }, []);

  const onMove = useCallback((x, y, evt) => {
    setState((s) => {
      if (!s.dragging || !s.start) return s;
      return {
        ...s,
        current: { x, y },
        delta: { x: x - s.start.x, y: y - s.start.y },
        lastEvent: evt.type,
      };
    });
  }, []);

  const onEnd = useCallback((evt) => {
    setState((s) => ({ ...s, dragging: false, lastEvent: evt.type }));
  }, []);

  const bind = useCallback((el) => {
    if (!el) return;
    const handleMouseDown = (e) => onStart(e.clientX, e.clientY, e);
    const handleMouseMove = (e) => onMove(e.clientX, e.clientY, e);
    const handleMouseUp = (e) => onEnd(e);

    const handleTouchStart = (e) => {
      const t = e.touches[0];
      onStart(t.clientX, t.clientY, e);
    };
    const handleTouchMove = (e) => {
      const t = e.touches[0];
      onMove(t.clientX, t.clientY, e);
    };
    const handleTouchEnd = (e) => onEnd(e);

    el.addEventListener("mousedown", handleMouseDown);
    window.addEventListener("mousemove", handleMouseMove);
    window.addEventListener("mouseup", handleMouseUp);

    el.addEventListener("touchstart", handleTouchStart);
    window.addEventListener("touchmove", handleTouchMove);
    window.addEventListener("touchend", handleTouchEnd);

    return () => {
      el.removeEventListener("mousedown", handleMouseDown);
      window.removeEventListener("mousemove", handleMouseMove);
      window.removeEventListener("mouseup", handleMouseUp);

      el.removeEventListener("touchstart", handleTouchStart);
      window.removeEventListener("touchmove", handleTouchMove);
      window.removeEventListener("touchend", handleTouchEnd);
    };
  }, [onStart, onMove, onEnd]);

  const reset = useCallback(() => {
    setState({
      dragging: false,
      start: null,
      current: null,
      delta: { x: 0, y: 0 },
      lastEvent: null,
    });
  }, []);

  return { ref: (node) => { if (node) bind(node); ref.current = node; }, state, reset };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React from "react";
import useGesture from "./hooks/useGesture";

export default function App() {
  const { ref, state, reset } = useGesture();

  return (
    <div style={{ padding: 20 }}>
      <h1>useGesture 제스처 감지</h1>
      <p>박스를 드래그하거나 터치/스와이프 해보세요.</p>

      <div
        ref={ref}
        style={{
          width: 200,
          height: 200,
          background: state.dragging ? "#60a5fa" : "#cbd5e1",
          borderRadius: 12,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          userSelect: "none",
          touchAction: "none",
        }}
      >
        {state.dragging ? "드래그 중" : "대기 중"}
      </div>

      <div style={{ marginTop: 20 }}>
        <p><strong>dragging:</strong> {String(state.dragging)}</p>
        <p><strong>start:</strong> {state.start ? `${state.start.x}, ${state.start.y}` : "-"}</p>
        <p><strong>current:</strong> {state.current ? `${state.current.x}, ${state.current.y}` : "-"}</p>
        <p><strong>delta:</strong> {`${state.delta.x}, ${state.delta.y}`}</p>
        <p><strong>lastEvent:</strong> {state.lastEvent}</p>
        <button onClick={reset}>리셋</button>
      </div>
    </div>
  );
}
```

---

### 동작 방식

1. `mousedown/touchstart` → drag 시작점 기록
2. 이동 시 `delta`(시작 대비 변화량) 계산
3. `mouseup/touchend` → drag 종료, 상태 초기화 가능
4. `ref`를 대상 DOM에 연결하면 제스처 감지 활성화

---

### 활용 아이디어

* **스와이프 UI**: delta.x 크기로 왼/오른쪽 스와이프 판단
* **드래그 앤 드롭**: drag 시작 → delta 기반 위치 업데이트
* **멀티터치 확장**: 두 손가락 입력으로 `pinch`, `rotate` 제스처 구현 가능

---

다음은 **99번 – useFormValidation 폼 검증**으로 넘어가시겠습니까?
