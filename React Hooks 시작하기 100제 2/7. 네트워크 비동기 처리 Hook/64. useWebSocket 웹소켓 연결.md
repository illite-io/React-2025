좋습니다. 이제 **64번 – useWebSocket 웹소켓 연결** 예제를 보겠습니다.

---

## 64. useWebSocket 웹소켓 연결

### 목표

* 웹소켓 연결을 열고/닫고, 메시지를 송수신할 수 있도록 관리
* 연결 상태(`connected`)와 수신 메시지(`messages`) 추적
* 자동 재연결 옵션 추가 가능

---

### 파일 경로 / 파일명

```
src/hooks/useWebSocket.js
src/App.js
```

---

### 1) 커스텀 훅 – `useWebSocket.js`

```javascript
import { useEffect, useRef, useState, useCallback } from "react";

/**
 * useWebSocket(url, { reconnect, reconnectInterval }?)
 * - url: 웹소켓 서버 주소
 * - reconnect: 연결 끊어졌을 때 재연결 여부 (기본 true)
 * - reconnectInterval: 재연결 간격(ms) (기본 3000)
 *
 * 반환:
 * { connected, messages, sendMessage, clearMessages }
 */
export default function useWebSocket(url, opts = {}) {
  const { reconnect = true, reconnectInterval = 3000 } = opts;

  const [connected, setConnected] = useState(false);
  const [messages, setMessages] = useState([]);
  const wsRef = useRef(null);
  const reconnectTimer = useRef(null);

  const connect = useCallback(() => {
    if (!url) return;
    const ws = new WebSocket(url);
    wsRef.current = ws;

    ws.onopen = () => {
      setConnected(true);
      console.log("웹소켓 연결됨");
    };

    ws.onmessage = (event) => {
      setMessages((prev) => [...prev, event.data]);
    };

    ws.onclose = () => {
      setConnected(false);
      console.log("웹소켓 연결 끊김");
      if (reconnect) {
        reconnectTimer.current = setTimeout(connect, reconnectInterval);
      }
    };

    ws.onerror = (err) => {
      console.error("웹소켓 에러:", err);
      ws.close();
    };
  }, [url, reconnect, reconnectInterval]);

  useEffect(() => {
    connect();
    return () => {
      if (reconnectTimer.current) clearTimeout(reconnectTimer.current);
      wsRef.current?.close();
    };
  }, [connect]);

  const sendMessage = useCallback((msg) => {
    if (wsRef.current && connected) {
      wsRef.current.send(msg);
    }
  }, [connected]);

  const clearMessages = useCallback(() => setMessages([]), []);

  return { connected, messages, sendMessage, clearMessages };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React, { useState } from "react";
import useWebSocket from "./hooks/useWebSocket";

export default function App() {
  const { connected, messages, sendMessage, clearMessages } = useWebSocket(
    "wss://ws.postman-echo.com/raw" // 테스트용 공개 웹소켓 서버
  );
  const [input, setInput] = useState("");

  const handleSend = () => {
    if (input.trim()) {
      sendMessage(input);
      setInput("");
    }
  };

  return (
    <div style={{ padding: 20 }}>
      <h1>useWebSocket 웹소켓 연결</h1>
      <p>연결 상태: {connected ? "✅ 연결됨" : "❌ 끊김"}</p>

      <div style={{ display: "flex", gap: 8, marginBottom: 10 }}>
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          placeholder="메시지 입력"
        />
        <button onClick={handleSend} disabled={!connected}>
          전송
        </button>
        <button onClick={clearMessages}>메시지 초기화</button>
      </div>

      <ul style={{ maxHeight: 200, overflow: "auto", border: "1px solid #ccc", padding: 10 }}>
        {messages.map((msg, i) => (
          <li key={i}>{msg}</li>
        ))}
      </ul>
    </div>
  );
}
```

---

### 동작 방식

1. `useWebSocket(url)` → 웹소켓 연결 생성
2. `onmessage` 이벤트 발생 시 `messages` 배열에 추가
3. `sendMessage` 호출 시 서버로 데이터 전송
4. 연결 종료 시 `onclose` → 자동 재연결 (옵션)

---

### 활용 아이디어

* **실시간 채팅**
* **주식/코인 시세 스트리밍**
* **알림 시스템** (서버 푸시)

---

다음은 **65번 – useSSE 서버센트 이벤트 구독** 예제로 넘어가시겠습니까?
