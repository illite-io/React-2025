좋습니다. 이번에는 **66번 – useGraphQL GraphQL 요청** 예제를 보겠습니다.

---

## 66. useGraphQL GraphQL 요청

### 목표

* GraphQL API 요청을 단순화하는 커스텀 훅
* `query`(또는 `mutation`)와 `variables`를 받아서 실행
* `loading`, `error`, `data` 상태 관리

---

### 파일 경로 / 파일명

```
src/hooks/useGraphQL.js
src/App.js
```

---

### 1) 커스텀 훅 – `useGraphQL.js`

```javascript
import { useCallback, useState } from "react";

/**
 * useGraphQL(endpoint)
 * - endpoint: GraphQL 서버 URL
 * 반환값: { loading, error, data, execute }
 * - execute(query, variables?): GraphQL 요청 실행
 */
export default function useGraphQL(endpoint) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [data, setData] = useState(null);

  const execute = useCallback(
    async (query, variables = {}) => {
      setLoading(true);
      setError(null);
      setData(null);
      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ query, variables }),
        });

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }

        const json = await res.json();
        if (json.errors) {
          throw new Error(json.errors.map((e) => e.message).join(", "));
        }
        setData(json.data);
        return json.data;
      } catch (err) {
        setError(err);
        throw err;
      } finally {
        setLoading(false);
      }
    },
    [endpoint]
  );

  return { loading, error, data, execute };
}
```

---

### 2) 사용 예제 – `App.js`

```javascript
import React, { useState } from "react";
import useGraphQL from "./hooks/useGraphQL";

export default function App() {
  const { loading, error, data, execute } = useGraphQL(
    "https://countries.trevorblades.com/" // 공개 GraphQL API
  );
  const [code, setCode] = useState("KR");

  const handleFetch = () => {
    const query = `
      query GetCountry($code: ID!) {
        country(code: $code) {
          name
          native
          capital
          emoji
          currency
        }
      }
    `;
    execute(query, { code });
  };

  return (
    <div style={{ padding: 20 }}>
      <h1>useGraphQL GraphQL 요청</h1>
      <input
        value={code}
        onChange={(e) => setCode(e.target.value.toUpperCase())}
        placeholder="국가 코드 입력 (예: US, KR, JP)"
        style={{ marginRight: 10, padding: "6px 10px" }}
      />
      <button onClick={handleFetch}>국가 정보 가져오기</button>

      {loading && <p>불러오는 중...</p>}
      {error && <p style={{ color: "red" }}>에러: {error.message}</p>}
      {data && data.country && (
        <div style={{ marginTop: 12 }}>
          <h2>
            {data.country.name} {data.country.emoji}
          </h2>
          <p>수도: {data.country.capital}</p>
          <p>통화: {data.country.currency}</p>
          <p>원어: {data.country.native}</p>
        </div>
      )}
    </div>
  );
}
```

---

### 동작 방식

1. `execute(query, variables)` 실행 시 GraphQL 서버에 POST 요청
2. 성공하면 `data`에 JSON 결과 저장
3. 실패 시 `error` 상태 업데이트

---

### 활용 아이디어

* **검색 UI**: GraphQL 쿼리 기반 조건 검색
* **게시판**: 목록, 상세, 댓글을 각각 쿼리로 분리
* **mutation**: 글쓰기, 수정, 삭제 시 `execute`로 간단히 처리

---

다음은 **67번 – useApiCache API 캐싱** 예제로 넘어가시겠습니까?
